<?php
namespace frontend\controllers;


use backend\models\City;
use backend\models\Group;
use backend\models\MainApp;
use backend\models\Province;
use backend\models\Tblcategory;
use backend\models\TblcategoryProduct;
use backend\models\Tblcoordinates;
use backend\models\Tbldoctor;
use backend\models\Tblfoqtakhasos;
use backend\models\Tblgallery;
use backend\models\Tblnobat;
use backend\models\Tblomomi;
use backend\models\TblPresence;
use backend\models\Tblproduct;
use backend\models\TblProfile;
use backend\models\Tbltakhasos;
use backend\models\Tblworks;
use common\components\General;
use common\components\jdf;
use common\models\User;
use frontend\models\Adsl;
use frontend\models\Ameliyateforosh;
use frontend\models\Categoryproduct;
use frontend\models\Exist;
use frontend\models\FaceExist;
use frontend\models\Factor;
use frontend\models\FactorNgn;
use frontend\models\Formbazaryab;
use frontend\models\Foroshtejary;
use frontend\models\Gallery;
use frontend\models\Host;
use frontend\models\Hozefaaliyat;
use frontend\models\Idc;
use frontend\models\Karshenasnasb;
use frontend\models\Khadamat;
use frontend\models\Location;
use frontend\models\Morakhasi;
use frontend\models\Mosaede;
use frontend\models\PasswordForm;
use frontend\models\PHPWebSocket;
use frontend\models\Pishnehadenteqad;
use frontend\models\Post;
use frontend\models\Product;
use frontend\models\Profile;
use frontend\models\Sabtnam;
use frontend\models\TbExpertDoctor;
use frontend\models\TbFellowship;
use frontend\models\TbGeneralDoctor;
use frontend\models\TblAddedInformation;
use frontend\models\Tblbag;
use frontend\models\Tblbrand;
use frontend\models\Tblnotification;
use frontend\models\TblPhone;
use frontend\models\TblServices1;
use frontend\models\Tbltarget;
use frontend\models\TbPh;
use frontend\models\TbPierreMedical;
use frontend\models\UserMain;
use phpDocumentor\Reflection\Types\Null_;
use yii;
use yii\rest\ActiveController;


/**
 * Country Controller API
 *
 * @author Budi Irawan <deerawan@gmail.com>
 */
class AndroidController extends ActiveController
{
    public $modelClass = 'frontend\models\Tblsize';


    public function init()
    {
        if (\Yii::$app->request->authUser != null && \Yii::$app->request->authPassword != null) {

            $username = \Yii::$app->request->authUser;;
            $password = \Yii::$app->request->authPassword;
            $user = User::findByUsername($username);
            if ($user != null) {
                if ($user->validatePassword($password)) {
                    Yii::$app->getUser()->login($user);

                } else {
                    print "یوزر و پسورد شما اشتباه است";
                    exit;
                }
            }
        }

        parent::init();
        \Yii::$app->user->enableSession = false;
    }


    public function behaviors()
    {
        $behaviors = parent::behaviors();
        $behaviors['authenticator'] = [
            'class' => yii\filters\auth\HttpBasicAuth::className(),
            'auth' => function ($user, $pass) {
                $user = User::findByUsername($user);
                if ($user != null) {
                    return $user;
                }

            },
            'only' => ['myorderse'],
        ];
        $behaviors['access'] = [

            'class' => yii\filters\AccessControl::className(),
            'only' => ['login', 'list_ostan', 'list_city', 'signup', 'all_form', 'factor_adsl_vdsl_owa_tdlte_iptv',
                'adsl_vdsl_pishshomare', 'factor_ngn_mvno_cdn_vas', 'factor_y','gozaremorakhasi'
                ,'Karshenas_nasb_mablaq','savepres','getpolyline','changepassword'],
            'rules' => [
                [
                    'actions' => ['login', 'list_ostan', 'list_city', 'signup', 'all_form', 'factor_adsl_vdsl_owa_tdlte_iptv',
                        'adsl_vdsl_pishshomare', 'factor_ngn_mvno_cdn_vas', 'factor_y','gozaremorakhasi'
                        ,'Karshenas_nasb_mablaq','savepres','getpolyline','changepassword'],
                    'allow' => true,
                    'roles' => ['?'],
                ],

                [
                    'actions' => ['login', 'list_ostan', 'list_city', 'signup', 'all_form', 'factor_adsl_vdsl_owa_tdlte_iptv',
                        'adsl_vdsl_pishshomare', 'factor_ngn_mvno_cdn_vas', 'factor_y','gozaremorakhasi'
                        ,'Karshenas_nasb_mablaq','savepres','getpolyline','changepassword'],
                    'allow' => true,
                    'roles' => ['@'],
                ],
            ],
        ];

        return $behaviors;
    }

    public function checkAccess($action, $model = null, $params = [])
    {
        return $model;
    }

    public function actions()
    {
        $action = parent::actions(); // TODO: Change the autogenerated stub
        unset($action['create']);
        return $action;
    }


    public function actionList_ostan()
    {
        if (Yii::$app->user->isGuest) {

            $sendOk['msg'] = "  شما لاگین نکرده اید ";
            $sendOk['result'] = 0;
            return $sendOk;

        }
        $ostan = \frontend\models\Province::find()->all();

        foreach ($ostan as $os) {
            $send['ostan'] = $os->name;
            $send['id_ostan'] = $os->id;

            $sendFull[] = $send;
        }
        $sendOk['ostan'] = $sendFull;


        $sendOk['result'] = 1;
        return $sendOk;

    }


    public function actionList_city()
    {

        if (isset($_POST['ostan']) && $_POST['ostan'] != null) {
            $ostan = \frontend\models\Province::find()->where(['name' => $_POST['ostan']])->one();
            $query = City::find()->where(['province_id' => $ostan->id])->all();
            if ($query == null) {
                $send['city'] = "هیچ شهرستانی ندارد";
                $sendFull[] = $send;
                $sendOk['city'] = $sendFull;
                $sendOk['result'] = 1;
                return $sendOk;
                exit();
            }
            foreach ($query as $os) {
                $send['city'] = $os->name;
                $sendFull[] = $send;
            }
            $sendOk['city'] = $sendFull;
            $sendOk['result'] = 1;

            return $sendOk;
        } else {
            $sendOk['msg'] = "اطلاعات ارسالی درست نمی باشد";
            $sendOk['result'] = 0;
            return $sendOk;

        }
    }


/*
 * این اکشن برای ارسال پیش شماره برای
 * adsl,vdsl ,z
 * می باشد
 */

    public function actionAdsl_vdsl_pishshomare()
    {


        if (isset($_POST['type']) && $_POST['type'] != null) {

            if ($_POST['type'] == 'adsl' || $_POST['type'] == 'vdsl' || $_POST['type'] == 'z') {


                $pishshomare1 = TblPhone::find()->select('DISTINCT `pishshomare`')->all();

                $sendList['pishshomare'] = '';
                foreach ($pishshomare1 as $pishshomareee) {

                    $sendList['pishshomare'] .= $pishshomareee->pishshomare . ',';


                }
                $sendOk['pishshomare'] = $sendList;
                $sendOk['result'] = 1;
                return $sendOk;

            } else {

                $sendOk['msg'] = "اطلاعات به اکشن مناسب ارسال نشده است ";
                $sendOk['result'] = 0;
                return $sendOk;
            }

        }  // چک کردن اینکه ایا تایپ ارسال شده یا نه

        else {

            $sendOk['msg'] = "اطلاعات ارسالی درست نمی باشد:گزینه مورد نظر را انتخاب کنید. ";
            $sendOk['result'] = 0;
            return $sendOk;
        }

    }



//در این اکشن اطلاعات سرویس و اطلاعات افزوده برای اندروید ارسال می شود.
//اگر type== adsl || type == vdsl مرکز مخابراتی نیز چک میشود
//action done
    public function actionAll_form()
    {


        if (isset($_POST['type']) && $_POST['type'] != null) {


            $ranzh = Sabtnam::find()->where(['name' => $_POST['type']])->one();
          

            if ($ranzh != null) {

                $sendOk['ranzh'] = $ranzh->ranzh;
            } else {
                $sendOk['msg'] = "اطلاعات ارسالی درست نمی باشد:گزینه ای که انتخاب کرده اید در منوی ثبت نام موجود نیست ";
                $sendOk['result'] = 0;
                return $sendOk;
            }


            if ($_POST['type'] == 'z') {

                if (isset($_POST['shomare']) && $_POST['shomare'] != null
                    && isset($_POST['pishshomare']) && $_POST['pishshomare'] != null
                ) {

                    $chek_markaz = TblPhone::find()->where(['pishshomare' => $_POST['pishshomare']])
                        ->andWhere(['enable' => '1'])->andWhere(['enableview' => '1'])->all();


                    if ($chek_markaz != null) {

                        foreach ($chek_markaz as $item) {

                            if ($_POST['shomare'] >= $item->reng_az && $_POST['shomare'] <= $item->reng_ta) {


                                $vazeyate_forosh = $item->vaziyat_forosh;

                                if ($vazeyate_forosh == '1') {
                                    $y = 'قابل فروش';
                                    $send['chek'] = 1;

                                }
                                if ($vazeyate_forosh == '0') {

                                    $y = 'غیرقابل فروش';
                                    $send['chek'] = 2;

                                }
                                $vazeyat = $item->vaziyat;
                                if ($vazeyat == '3') {
                                    $x = 'محدود';
                                    $send['chek'] = 0;


                                } elseif ($vazeyat == '1') {
                                    $x = 'قابل پوشش';
                                    $send['chek'] = 1;

                                } elseif ($vazeyat == '2') {
                                    $x = 'غیرمحدود';
                                    $send['chek'] = 1;

                                } elseif ($vazeyat == '0') {
                                    $x = 'غیرقابل پوشش';
                                    $send['chek'] = 3;

                                }

                                $send['msg'] = 'خط فوق مربوط به مرکز ' . $item->name_markaz . '  می باشد و ثبت نام در این مرکز ' . $x . ' و ' . $y . ' می باشد';
//
                                $sendOk['chek_name'] = $send;

                            }


                        }


                        $hoze_faliyat = Hozefaaliyat::find()->where(['enable' => 1])
                            ->andWhere(['enableview' => 1])->all();


                        if ($hoze_faliyat != null) {

                            $sendList['hozefaliyat'] = '';
                            foreach ($hoze_faliyat as $hf) {

                                $sendList['hozefaliyat'] .= $hf->name . ',';
                            }

                            $sendOk['hoze_faaliyat'] = $sendList;

                        } else {
                            $sendOk['hoze_faaliyat'] = 'موجود نیست';
                        }


                        $sendOk['result'] = 1;
                        return $sendOk;


                    } elseif ($chek_markaz == null) {
                        $sendOk['chek_name'] = 'موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;

                    }


                } else {

                    $sendOk['msg'] = "اطلاعات ارسالی درست نمی باشد: یکی از موارد  شماره و پیش شماره ارسال نشده است  ";
                    $sendOk['result'] = 0;
                    return $sendOk;
                }
            }


            //chek == 0 پیش ثبت نام
            // chek == 1 ثبت نام اصلی
            //chek == 2 گرفتن یکسری اطلاعات
            //chek == 3  غیر قابل ثبت نام
            // چک می کند که قبلا این شماره در جدول ذخیره نشده باشد.
            elseif($_POST['type'] == 'adsl' || $_POST['type'] == 'vdsl') {
//                return 2;
                if (isset($_POST['shomare']) && $_POST['shomare'] != null
                    && isset($_POST['pishshomare']) && $_POST['pishshomare'] != null
                    && isset($_POST['id_user']) && $_POST['id_user'] != null
                ) {

                    $impload=$_POST['pishshomare'].'_'.$_POST['shomare'];

                   $search=Adsl::find()->where(['eshterak'=> $impload])->andWhere(['type'=>$_POST['type']])->one();


                  
                    if($search == null){


                        $chek_markaz = TblPhone::find()->where(['sabtenam' => $_POST['type']])->andWhere(['pishshomare' => $_POST['pishshomare']])
                            ->andWhere(['enable' => '1'])->andWhere(['enableview' => '1'])->all();

                        if ($chek_markaz == null) {


                            $sendOk['msg'] = "مرکزی یافت نشد";
                            $sendOk['result'] =0;
                            return $sendOk;

                        } else {

$ok=0;

                            foreach ($chek_markaz as $item) {

                                if ($_POST['shomare'] >= $item->reng_az || $_POST['shomare'] < $item->reng_ta) {

                                    $ok = 1;

                                    $vazeyate_forosh = $item->vaziyat_forosh;

                                    if ($vazeyate_forosh == '1') {
                                        $y = 'قابل فروش';
                                        $send['chek'] = 1;

                                    }
                                    if ($vazeyate_forosh == '0') {

                                        $y = 'غیرقابل فروش';
                                        $send['chek'] = 2;

                                    }
                                    $vazeyat = $item->vaziyat;
                                    if ($vazeyat == '3') {
                                        $x = 'محدود';
                                        $send['chek'] = 0;


                                    } elseif ($vazeyat == '1') {
                                        $x = 'قابل پوشش';
                                        $send['chek'] = 1;

                                    } elseif ($vazeyat == '2') {
                                        $x = 'غیرمحدود';
                                        $send['chek'] = 1;

                                    } elseif ($vazeyat == '0') {
                                        $x = 'غیرقابل پوشش';
                                        $send['msg'] = 'خط فوق مربوط به مرکز ' . $item->name_markaz . '  می باشد و ثبت نام در این مرکز ' . $x . ' و ' . $y . '  می باشد';
                                        $send['chek'] = 3;
                                        $sendOk['chek_name'] = $send;
                                        $sendOk['result'] = 0;
                                        return $sendOk;

                                    }


                                    $target = Tbltarget::find()->where(['sabtnam' => $_POST['type']])->andWhere(['id_user' => $_POST['id_user']])->count();

                                    if ($target >= 1) {

                                        $send['msg'] = 'خط فوق مربوط به مرکز ' . $item->name_markaz . '  می باشد و ثبت نام در این مرکز ' . $x . ' و ' . $y . ' و تارگت فروش دارد می باشد';

                                    } else {
                                        $send['msg'] = 'خط فوق مربوط به مرکز ' . $item->name_markaz . '  می باشد و ثبت نام در این مرکز ' . $x . ' و ' . $y . ' و تارگت فروش ندارد می باشد';
                                        $send['chek'] = 1;

                                        $sendOk['chek_name'] = $send;
//                                    $sendOk['result'] = 1;
//                                    return $sendOk;
                                    }

                                   
                                } else {


                                    $send1['chek_name'] = "مرکزی یافت نشد";
                                    $send1['chek'] = 3;
                                    $send1['result'] = 0;

                                }


                            }
                            if($ok==1){
                                $sendOk['chek_name'] = $send;
                            }else{
                                $sendOk['chek_name'] = $send1;
                                return $sendOk;
                            }



                            $services = TblServices1::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                                ->andWhere(['enableview' => 1])->all();

                            $service_name = TblServices1::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                                ->andWhere(['enableview' => 1])->select('DISTINCT `name`')->all();

                            if ($service_name != null) {

                                $senService_name['name'] = '';

                                foreach ($service_name as $sn) {

                                    $senService_name['name'] .= $sn->name . ',';

                                }
                                $sendOk['service_name'] = $senService_name;


                            } else {
                                $sendOk['service_name'] = 'اطلاعاتی یافت نشد';
                            }


                            if ($services != null) {

                                foreach ($services as $service) {

                                    $sendService['id'] = $service->id;
                                    $sendService['name'] = $service->name;
                                    $sendService['speed'] = $service->speed;
                                    $sendService['hajm'] = $service->hajm;
                                    $sendService['time'] = $service->time;
                                    $sendService['price'] = $service->price;
                                    $sendFull2[] = $sendService;

                                }
                                $sendOk['service'] = $sendFull2;


                            } else {
                                $sendOk['service'] = "اطلاعات ارسالی درست نمی باشد:هیچ سرویس برای این type موجود نیست ";

                            }


                            $addeds = TblAddedInformation::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                                ->andWhere(['enableview' => 1])->all();

                            $added_name = TblAddedInformation::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                                ->andWhere(['enableview' => 1])->select('DISTINCT `name`')->all();

                            if ($added_name != null) {
                                $sendAdded_name['name'] = '';
                                foreach ($added_name as $an) {

                                    $sendAdded_name['name'] .= $an->name . ',';


                                }
                                $sendOk['added_name'] = $sendAdded_name;


                            } else {
                                $sendOk['added_name'] = 'اطلاعاتی یافت نشد';
                            }


                            if ($addeds != null) {

                                foreach ($addeds as $added) {

                                    $sendAdded['id'] = $added->id;
                                    $sendAdded['name'] = $added->name;
                                    $sendAdded['speed'] = $added->speed;
                                    $sendAdded['hajm'] = $added->hajm;
                                    $sendAdded['time'] = $added->time;
                                    $sendAdded['price'] = $added->price;
                                    $sendAdded['servic'] = $added->service;
                                    $sendFull4[] = $sendAdded;

                                }
                                $sendOk['added'] = $sendFull4;


                            } else {
                                $sendOk['added'] = "اطلاعات ارسالی درست نمی باشد:هیچ اطلاعات افزوده ای برای این type موجود نیست ";

                            }


                            $sendOk['result'] = 1;
                            return $sendOk;




                        }
                    }else{
                        $sendOk['msg'] = "قبلا رانژه شده است. ";
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }



                } else {

                    $sendOk['msg'] = "اطلاعات ارسالی درست نمی باشد  ";
                    $sendOk['result'] = 0;
                    return $sendOk;
                }
                // else :چک کردن خالی نبودن اطلاعات ارسالی

            }//type == adsl || type == vdsl
            elseif ($_POST['type'] == 'owa' || $_POST['type'] == 'td-lte') {


                $services = TblServices1::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                    ->andWhere(['enableview' => 1])->all();

                $service_name = TblServices1::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                    ->andWhere(['enableview' => 1])->select('DISTINCT `name`')->all();

                if ($service_name != null) {

                    $senService_name['name'] = '';

                    foreach ($service_name as $sn) {

                        $senService_name['name'] .= $sn->name . ',';

                    }
                    $sendOk['service_name'] = $senService_name;


                } else {
                    $sendOk['service_name'] = 'اطلاعاتی یافت نشد';
                }

                if ($services != null) {

                    foreach ($services as $service) {

                        $sendService['id'] = $service->id;
                        $sendService['name'] = $service->name;
                        $sendService['speed'] = $service->speed;
                        $sendService['hajm'] = $service->hajm;
                        $sendService['time'] = $service->time;
                        $sendService['price'] = $service->price;
                        $sendFull2[] = $sendService;

                    }
                    $sendOk['service'] = $sendFull2;


                } else {
                    $sendOk['service'] = "اطلاعات ارسالی درست نمی باشد:هیچ سرویس برای این type موجود نیست ";

                }


                $addeds = TblAddedInformation::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                    ->andWhere(['enableview' => 1])->all();

                $added_name = TblAddedInformation::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                    ->andWhere(['enableview' => 1])->select('DISTINCT `name`')->all();

                if ($added_name != null) {
                    $sendAdded_name['name'] = '';
                    foreach ($added_name as $an) {

                        $sendAdded_name['name'] .= $an->name . ',';


                    }
                    $sendOk['added_name'] = $sendAdded_name;


                } else {
                    $sendOk['added_name'] = 'اطلاعاتی یافت نشد';
                }


                if ($addeds != null) {

                    foreach ($addeds as $added) {

                        $sendAdded['id'] = $added->id;
                        $sendAdded['name'] = $added->name;
                        $sendAdded['speed'] = $added->speed;
                        $sendAdded['hajm'] = $added->hajm;
                        $sendAdded['time'] = $added->time;
                        $sendAdded['price'] = $added->price;
                        $sendAdded['servic'] = $added->service;
                        $sendFull4[] = $sendAdded;

                    }
                    $sendOk['added'] = $sendFull4;


                } else {
                    $sendOk['added'] = "اطلاعات ارسالی درست نمی باشد:هیچ اطلاعات افزوده ای برای این type موجود نیست ";

                }


                $sendOk['result'] = 1;

                return $sendOk;

            }//type == 0wa || type == tdlte

            elseif ($_POST['type'] == 'ngn' || $_POST['type'] == 'mvno') {


                if ($_POST['type'] == 'ngn') {


                    $ip_asiyatek1 = TblServices1::find()->where(['sabtnam' => 'ngn'])
                        ->andWhere(['enable' => 1])->andWhere(['enableview' => 1])->one();


                    $sendOk['ip_asiyatek'] = $ip_asiyatek1->type;

                }


                $addeds = TblAddedInformation::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                    ->andWhere(['enableview' => 1])->all();


                if ($addeds != null) {

                    foreach ($addeds as $added) {

                        $sendAdded['id'] = $added->id;
                        $sendAdded['name'] = $added->name;
                        $sendAdded['speed'] = $added->speed;
                        $sendAdded['hajm'] = $added->hajm;
                        $sendAdded['time'] = $added->time;
                        $sendAdded['price'] = $added->price;
                        $sendFull4[] = $sendAdded;

                    }
                    $sendOk['added'] = $sendFull4;
                    $sendOk['result']=1;

                } else {
                    $sendOk['added'] = "اطلاعات ارسالی درست نمی باشد:هیچ اطلاعات افزوده ای برای این type موجود نیست ";
                    $sendOk['result']=0;
                }


                return $sendOk;
            }//type == ngn || type == mvno

            elseif ($_POST['type'] == 'idc' || $_POST['type'] == 'vpn' || $_POST['type'] == 'x') {


                $khadamat = Khadamat::find()->where(['sabtnam' => $_POST['type']])->andWhere(['enable' => 1])
                    ->andWhere(['enableview' => 1])->all();

                if ($khadamat != null) {


                    foreach ($khadamat as $k) {

                        $sendKhadamat['id'] = $k->id;
                        $sendKhadamat['type_bastar'] = $k->type_bastar;
                        $sendKhadamat['time'] = $k->time;
                        $sendKhadamat['mizan_darkhasti'] = $k->mizan_darkhasti;
                        $sendKhadamat['price'] = $k->price;
                        $sendFull6[] = $sendKhadamat;

                    }
                    $sendOk['khadamat'] = $sendFull6;

                } else {
                    $sendOk['khadamat'] = 'اطلاعات ارسالی درست نمی باشد:هیچ خدماتی برای این type موجود نیست ';
                }
                return $sendOk;
            }//type == idc || type=vpn || type== x
            elseif ($_POST['type'] == 'iptv') {

                $sbt = TblServices1::find()->where(['sabtnam' => $_POST['type']])
                    ->andWhere(['enable' => 1])->andWhere(['enableview' => 1])->all();
                if ($sbt != null) {

                    foreach ($sbt as $s) {
                        $send['id'] = $s->id;
                        $send['type_sbt'] = $s->name;
                        $send['time'] = $s->time;
                        $send['price'] = $s->price;
                        $sendFull7[] = $send;
                    }

                    $sendOk['SBT'] = $sendFull7;


                } else {
                    $sendOk['SBT'] = 'هیچ مدلی ثبت نشده است.';
                    $sendOk['result'] = 0;
                }

                $added = TblAddedInformation::find()->where(['sabtnam' => $_POST['type']])
                    ->andWhere(['enable' => 1])->andWhere(['enableview' => 1])->all();

                if ($added != null) {

                    foreach ($added as $ad) {
                        $sendList['id'] = $ad->id;
                        $sendList['price'] = $ad->price;
                        $sendFull8 = $sendList;
                    }

                    $sendOk['added'] = $sendFull8;
                    $sendOk['result'] = 1;

                } else {
                    $sendOk['added'] = 'هیچ مدلی ثبت نشده است.';
                    $sendOk['result'] = 0;
                }

                return $sendOk;
            }//type == iptv

            elseif ($_POST['type'] == 'y') {


                $y = TblServices1::find()->where(['sabtnam' => 'y'])
                    ->andWhere(['enable' => 1])->andWhere(['enableview' => 1])->one();

                if ($y != null) {
                    $sendOk['y'] = $y->type;
                    $sendOk['result'] = 1;
                    return $sendOk;
                }
                $sendOk['y'] = 'موجود نیست';
                $sendOk['result'] = 1;
                return $sendOk;

            }//type == y


            elseif ($_POST['type'] == 'domain') {

                $host = Host::find()->where(['enable' => 1])->andWhere(['enableview' => 1])->all();

                if ($host != null) {
                    foreach ($host as $h) {

                        $sendHost['id'] = $h->id;
                        $sendHost['name'] = $h->name;
                        $sendHost['faza'] = $h->faza;
                        $sendHost['time'] = $h->time;
                        $sendHost['terafik'] = $h->terafik;
                        $sendHost['systemamel'] = $h->systemamel;
                        $sendHost['controll_panel'] = $h->controll_panel;
                        $sendHost['pahnayeband'] = $h->pahnayeband;
                        $sendHost['price'] = $h->price;
                        $sendHost['discription'] = $h->discription;
                        $sendFull9[] = $sendHost;
                    }
                    $sendOk['host'] = $sendFull9;
                    $sendOk['result'] = 1;
                    return $sendOk;


                } else {
                    $sendOk['msg'] = 'موجود نیست.';
                    $sendOk['result'] = 1;
                    return $sendOk;

                }

            }//type == domain

            elseif ($_POST['type'] == 'host') {

                $host = Host::find()->where(['enable' => 1])->andWhere(['enableview' => 1])->all();

                if ($host != null) {
                    foreach ($host as $h) {

                        $sendHost['id'] = $h->id;
                        $sendHost['name'] = $h->name;
                        $sendHost['faza'] = $h->faza;
                        $sendHost['time'] = $h->time;
                        $sendHost['terafik'] = $h->terafik;
                        $sendHost['systemamel'] = $h->systemamel;
                        $sendHost['controll_panel'] = $h->controll_panel;
                        $sendHost['pahnayeband'] = $h->pahnayeband;
                        $sendHost['price'] = $h->price;
                        $sendHost['discription'] = $h->discription;
                        $sendFull9[] = $sendHost;
                    }
                    $sendOk['host'] = $sendFull9;
                    $sendOk['result'] = 1;
                    return $sendOk;


                } else {
                    $sendOk['msg'] = 'موجود نیست.';
                    $sendOk['result'] = 1;
                    return $sendOk;

                }

            }//type == host

            elseif($_POST['type'] == 'pwa'){

                 $mantaqe=TblPhone::find()->andWhere(['enable'=>'1'])->andWhere(['enableview'=>'1'])->all();
                if($mantaqe!=null){
                    foreach ($mantaqe as $kodam_mantaqe){

                        $send['id']=$kodam_mantaqe->id;
                        $send['ostan']=$kodam_mantaqe->ostan;
                        $send['shahr']=$kodam_mantaqe->shahr;
                        $send['name_markaz']=$kodam_mantaqe->name_markaz;
                        $sendList[]=$send;

                    }

                    $sendOk['kodam_mantaqe']=$sendList;

                }
                else{
                    $sendOk['kodam_mantaqe']=' در حال حاظر هیچ منطقه ای  موجود نمی باش.';
                }

                $service=TblServices1::find()->where(['enable'=>1])->andWhere(['enableview'=>1])->all();
                if($service!=null){


                 foreach ($service as $kodam_service){

//                     if($kodam_service == 'ADSL' || $kodam_service == 'VDSL'||
//                         $kodam_service == 'OWA' || $kodam_service == 'TD-LTE' ){


                         $send2['id']=$kodam_service->id;
                         $send2['type']=$kodam_service->sabtnam;
                         $send2['name']=$kodam_service->name;
                         $send2['soraat']=$kodam_service->speed;
                         $send2['hajm']=$kodam_service->hajm;
                         $send2['time']=$kodam_service->time;
                         $send2['price']=$kodam_service->price;
                         $sendList2[]=$send2;




                 }

                    $sendOk['kodam_service']=$sendList2;
                }
                else{
                    $sendOk['kodam_service']=' در حال حاظر هیچ سرویس  موجود نمی باش.';
                }

                $sendOk['result']= 1;
                return $sendOk;

            }

        } // چک کردن اینکه ایا تایپ ارسال شده یا نه
        else {

            $sendOk['msg'] = "اطلاعات ارسالی درست نمی باشد:گزینه مورد نظر را انتخاب کنید. ";
            $sendOk['result'] = 0;
            return $sendOk;
        }
    }




    public function actionFactor_adsl_vdsl_owa_tdlte_iptv()
    {

        $model = new Adsl();

        if (isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['chek']) && $_POST['chek'] != null
            && isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['name']) && $_POST['name'] != null
            && isset($_POST['lastname']) && $_POST['lastname'] != null
            && isset($_POST['codemeli']) && $_POST['codemeli'] != null
            && isset($_POST['shenasname']) && $_POST['shenasname'] != null
            && isset($_POST['tarikh_tavalod']) && $_POST['tarikh_tavalod'] != null
            && isset($_POST['mahale_sodur']) && $_POST['mahale_sodur'] != null
            && isset($_POST['name_malek']) && $_POST['name_malek'] != null
            && isset($_POST['lastname_malek']) && $_POST['lastname_malek'] != null
            && isset($_POST['codemeli_malek']) && $_POST['codemeli_malek'] != null
            && isset($_POST['cellphone']) && $_POST['cellphone'] != null
            && isset($_POST['cellphone2']) && $_POST['cellphone2'] != null
            && isset($_POST['telegram']) && $_POST['telegram'] != null
            && isset($_POST['phone']) && $_POST['phone'] != null
            && isset($_POST['adress']) && $_POST['adress'] != null
            && isset($_POST['codeposti']) && $_POST['codeposti'] != null
            && isset($_POST['email']) && $_POST['email'] != null
            && isset($_POST['ax_shenasaee']) && $_POST['ax_shenasaee'] != null
            && isset($_POST['ax_emza']) && $_POST['ax_emza'] != null
            && isset($_POST['discription']) && $_POST['discription'] != null
            && isset($_POST['ersal_barge_telegram']) && $_POST['ersal_barge_telegram'] != null
            && isset($_POST['ersal_mablaq_payamak']) && $_POST['ersal_mablaq_payamak'] != null
            && isset($_POST['id_services']) && $_POST['id_services'] != null
            && isset($_POST['id_added']) && $_POST['id_added'] != null
            && isset($_POST['price']) && $_POST['price'] != null
            && isset($_POST['date_farsi']) && $_POST['date_farsi'] != null
            && isset($_POST['name_pedar']) && $_POST['name_pedar'] != null
            && isset($_POST['lng']) && $_POST['lng'] != null
            && isset($_POST['lat']) && $_POST['lat'] != null
            && isset($_POST['id_tblservice1']) && $_POST['id_tblservice1'] != null
            && isset($_POST['id_tblphone']) && $_POST['id_tblphone'] != null
        ) {


            if ($_POST['type'] == 'adsl' || $_POST['type'] == 'vdsl')
            {


                if (isset($_POST['eshterak']) && $_POST['eshterak'] != null) {

//در این اکشن تاریخ ارسالی حتما باید با فرمت 1397/10/02 باشد یعنی با اسلش جدا شود
                    $date_ir = new jdf();
                    $time = explode("/", $_POST['date_farsi']);
                    $d = $time[0];
                    $m = $time[1];
                    $y = $time[2];
                    $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

                    $Y = $time2[0] . '-';
                    $M = $time2[1] . '-';
                    $D = $time2[2];
                    $g = $Y . $M . $D;

                    $model->date = date($g);


                    $model->type = $_POST['type'];
                    $model->vazeyat_sabt = $_POST['chek'];
                    $model->name = $_POST['name'];
                    $model->lastname = $_POST['lastname'];
                    $model->codemeli = $_POST['codemeli'];
                    $model->shenasname = $_POST['shenasname'];
                    $model->tarikh_tavalod = $_POST['tarikh_tavalod'];
                    $model->mahale_sodur = $_POST['mahale_sodur'];
                    $model->name_malek = $_POST['name_malek'];
                    $model->lastname_malek = $_POST['lastname_malek'];
                    $model->codemeli_malek = $_POST['codemeli_malek'];
                    $model->cellphone = $_POST['cellphone'];
                    $model->cellphone2 = $_POST['cellphone2'];
                    $model->telegram = $_POST['telegram'];
                    $model->phone = $_POST['phone'];
                    $model->adress = $_POST['adress'];
                    $model->codeposti = $_POST['codeposti'];
                    $model->email = $_POST['email'];
                    $model->ax_shenasaee = $_POST['ax_shenasaee'];
                    $model->ax_emza = $_POST['ax_emza'];
                    $model->discription = $_POST['discription'];
                    $model->ersal_barge_telegram = $_POST['ersal_barge_telegram'];
                    $model->ersal_mablaq_payamak = $_POST['ersal_mablaq_payamak'];
                    $model->id_services = $_POST['id_services'];
                    $model->id_added = $_POST['id_added'];
                    $model->price = $_POST['price'];
                    $model->date_farsi = $_POST['date_farsi'];
                    $model->name_pedar = $_POST['name_pedar'];
                    $model->lng = $_POST['lng'];
                    $model->lat = $_POST['lat'];
                    $model->id_tblservice1 = $_POST['id_tblservice1'];
                    $model->id_tblphone = $_POST['id_tblphone'];
                    $model->eshterak = $_POST['eshterak'];
                    $model->id_user = $_POST['id_user'];

                    if ($model->save(false)) {

                        $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }

                } else {
                    $sendOk['msg'] = '.اشتراک را وارد کنید.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }

            } else {

                $date_ir = new jdf();
                $time = explode("/", $_POST['date_farsi']);
                $d = $time[0];
                $m = $time[1];
                $y = $time[2];
                $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

                $Y = $time2[0] . '-';
                $M = $time2[1] . '-';
                $D = $time2[2];
                $g = $Y . $M . $D;

                $model->date = date($g);


                $model->type = $_POST['type'];
                $model->vazeyat_sabt = $_POST['chek'];
                $model->name = $_POST['name'];
                $model->lastname = $_POST['lastname'];
                $model->codemeli = $_POST['codemeli'];
                $model->shenasname = $_POST['shenasname'];
                $model->tarikh_tavalod = $_POST['tarikh_tavalod'];
                $model->mahale_sodur = $_POST['mahale_sodur'];
                $model->name_malek = $_POST['name_malek'];
                $model->lastname_malek = $_POST['lastname_malek'];
                $model->codemeli_malek = $_POST['codemeli_malek'];
                $model->cellphone = $_POST['cellphone'];
                $model->cellphone2 = $_POST['cellphone2'];
                $model->telegram = $_POST['telegram'];
                $model->phone = $_POST['phone'];
                $model->adress = $_POST['adress'];
                $model->codeposti = $_POST['codeposti'];
                $model->email = $_POST['email'];
                $model->ax_shenasaee = $_POST['ax_shenasaee'];
                $model->ax_emza = $_POST['ax_emza'];
                $model->discription = $_POST['discription'];
                $model->ersal_barge_telegram = $_POST['ersal_barge_telegram'];
                $model->ersal_mablaq_payamak = $_POST['ersal_mablaq_payamak'];
                $model->id_services = $_POST['id_services'];
                $model->id_added = $_POST['id_added'];
                $model->price = $_POST['price'];
                $model->date_farsi = $_POST['date_farsi'];
                $model->name_pedar = $_POST['name_pedar'];
                $model->lng = $_POST['lng'];
                $model->lat = $_POST['lat'];
                $model->id_tblservice1 = $_POST['id_tblservice1'];
                $model->id_tblphone = $_POST['id_tblphone'];
                $model->eshterak = $_POST['type'];
                $model->id_user = $_POST['id_user'];


                if ($model->save(false)) {

                    $model1 = Adsl::find()->where(['id' => $model->id])->one();
                    $model1->eshterak = $model1->eshterak . '_' . $model1->id;

                    if ($model1->save(false)) {
                        $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                        $sendOk['result'] = 1;
                        return $sendOk;
                    } else {
                        $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } else {
                    $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }

            }


        } else {
            $sendOk['msg'] = 'عملیات با موفقیت انجام نشد.اطلاعات ارسالی ناقص می باشد';
            $sendOk['result'] = 0;
            return $sendOk;

        }

    }

//action done
    public function actionFactor_ngn_mvno_cdn_vas()
    {

        $model = new FactorNgn();

        if (isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['name']) && $_POST['name'] != null
            && isset($_POST['lastname']) && $_POST['lastname'] != null
            && isset($_POST['codemeli']) && $_POST['codemeli'] != null
            && isset($_POST['shenasname']) && $_POST['shenasname'] != null
            && isset($_POST['tarikh_tavalod']) && $_POST['tarikh_tavalod'] != null
            && isset($_POST['mahale_sodur']) && $_POST['mahale_sodur'] != null
            && isset($_POST['cellphone']) && $_POST['cellphone'] != null
            && isset($_POST['cellphone2']) && $_POST['cellphone2'] != null
            && isset($_POST['telegram']) && $_POST['telegram'] != null
            && isset($_POST['phone']) && $_POST['phone'] != null
            && isset($_POST['adress']) && $_POST['adress'] != null
            && isset($_POST['code_posti']) && $_POST['code_posti'] != null
            && isset($_POST['email']) && $_POST['email'] != null
            && isset($_POST['ax_shenasaee']) && $_POST['ax_shenasaee'] != null
            && isset($_POST['ax_emza']) && $_POST['ax_emza'] != null
            && isset($_POST['discription']) && $_POST['discription'] != null
            && isset($_POST['ersal_barge_telegram']) && $_POST['ersal_barge_telegram'] != null
            && isset($_POST['ersal_mablaq_payam']) && $_POST['ersal_mablaq_payam'] != null
            && isset($_POST['shomare_asiyatek']) && $_POST['shomare_asiyatek'] != null
            && isset($_POST['type_shomare_ngn']) && $_POST['type_shomare_ngn'] != null
            && isset($_POST['shomare_darkhasti']) && $_POST['shomare_darkhasti'] != null
            && isset($_POST['kodam_ip']) && $_POST['kodam_ip'] != null
            && isset($_POST['price']) && $_POST['price'] != null
            && isset($_POST['date_farsi']) && $_POST['date_farsi'] != null
            && isset($_POST['tedad']) && $_POST['tedad'] != null
            && isset($_POST['name_pedar']) && $_POST['name_pedar'] != null
            && isset($_POST['lng']) && $_POST['lng'] != null
            && isset($_POST['dis']) && $_POST['dis'] != null
            && isset($_POST['nasbdarmahal']) && $_POST['nasbdarmahal'] != null
            && isset($_POST['niyazbasteinterneti']) && $_POST['niyazbasteinterneti'] != null
            && isset($_POST['name_domain']) && $_POST['name_domain'] != null
            && isset($_POST['be_shahr']) && $_POST['be_shahr'] != null
            && isset($_POST['tedad_sip']) && $_POST['tedad_sip'] != null
            && isset($_POST['tedad_soft']) && $_POST['tedad_soft'] != null
            && isset($_POST['type_shomare_ngn2']) && $_POST['type_shomare_ngn2'] != null
            && isset($_POST['type_vas']) && $_POST['type_vas'] != null
            && isset($_POST['nasb']) && $_POST['nasb'] != null
            && isset($_POST['lat']) && $_POST['lat'] != null
            && isset($_POST['keshvari_ostani']) && $_POST['keshvari_ostani'] != null
        ) {


            $date_ir = new jdf();
            $time = explode("/", $_POST['date_farsi']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $M = $time2[1] . '-';
            $D = $time2[2];
            $g = $Y . $M . $D;

            $model->date = date($g);


            $model->type = $_POST['type'];
            $model->shomare_asiyatek = $_POST['shomare_asiyatek'];
            $model->name = $_POST['name'];
            $model->lastname = $_POST['lastname'];
            $model->codemeli = $_POST['codemeli'];
            $model->shenasname = $_POST['shenasname'];
            $model->tarikh_tavalod = $_POST['tarikh_tavalod'];
            $model->mahale_sodur = $_POST['mahale_sodur'];
            $model->shomare_darkhasti = $_POST['shomare_darkhasti'];
            $model->nasb = $_POST['nasb'];
            $model->dis = $_POST['dis'];
            $model->cellphone = $_POST['cellphone'];
            $model->cellphone2 = $_POST['cellphone2'];
            $model->telegram = $_POST['telegram'];
            $model->phone = $_POST['phone'];
            $model->adress = $_POST['adress'];
            $model->name_domain = $_POST['name_domain'];
            $model->tedad = $_POST['tedad'];
            $model->ersal_mablaq_payam = $_POST['ersal_mablaq_payam'];
            $model->nasbdarmahal = $_POST['nasbdarmahal'];
            $model->niyazbasteinterneti = $_POST['niyazbasteinterneti'];
            $model->email = $_POST['email'];
            $model->ax_shenasaee = $_POST['ax_shenasaee'];
            $model->ax_emza = $_POST['ax_emza'];
            $model->discription = $_POST['discription'];
            $model->ersal_barge_telegram = $_POST['ersal_barge_telegram'];
            $model->code_posti = $_POST['code_posti'];
            $model->kodam_ip = $_POST['kodam_ip'];
            $model->type_shomare_ngn = $_POST['type_shomare_ngn'];
            $model->price = $_POST['price'];
            $model->be_shahr = $_POST['be_shahr'];
            $model->tedad_sip = $_POST['tedad_sip'];
            $model->tedad_soft = $_POST['tedad_soft'];
            $model->type_shomare_ngn2 = $_POST['type_shomare_ngn2'];
            $model->date_farsi = $_POST['date_farsi'];
            $model->name_pedar = $_POST['name_pedar'];
            $model->lng = $_POST['lng'];
            $model->lat = $_POST['lat'];
            $model->eshterak = $_POST['type'];
            $model->id_user = $_POST['id_user'];
            $model->type_vas = $_POST['type_vas'];
            $model->keshvari_ostani = $_POST['keshvari_ostani'];

            if ($model->save(false)) {

                $model1 = FactorNgn::find()->where(['id' => $model->id])->one();
                $model1->eshterak = $model1->eshterak . '_' . $model1->id;

                if ($model1->save(false)) {
                    $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                    $sendOk['result'] = 1;
                    return $sendOk;
                } else {
                    $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }


            } else {
                $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                $sendOk['result'] = 0;
                return $sendOk;
            }


        } else {
            $sendOk['msg'] = 'عملیات با موفقیت انجام نشد.اطلاعات ارسالی ناقص می باشد';
            $sendOk['result'] = 0;
            return $sendOk;

        }

    }
 
//x= pahnaye band
// action done
    public function actionFactor_idc_vpn_x_domain_host()
    {

        $model = new Idc();

        if (isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['id_khadamat']) && $_POST['id_khadamat'] != null
            && isset($_POST['name']) && $_POST['name'] != null
            && isset($_POST['lastname']) && $_POST['lastname'] != null
            && isset($_POST['namepedar']) && $_POST['namepedar'] != null
            && isset($_POST['codemeli']) && $_POST['codemeli'] != null
            && isset($_POST['shomareshenasname']) && $_POST['shomareshenasname'] != null
            && isset($_POST['tarikh_tavalod']) && $_POST['tarikh_tavalod'] != null
            && isset($_POST['cellphone']) && $_POST['cellphone'] != null
            && isset($_POST['cellphone2']) && $_POST['cellphone2'] != null
            && isset($_POST['lng']) && $_POST['lng'] != null
            && isset($_POST['lat']) && $_POST['lat'] != null
            && isset($_POST['adress']) && $_POST['adress'] != null
            && isset($_POST['codeposti']) && $_POST['codeposti'] != null
            && isset($_POST['email']) && $_POST['email'] != null
            && isset($_POST['name_sherkat']) && $_POST['name_sherkat'] != null
            && isset($_POST['shenase_meli']) && $_POST['shenase_meli'] != null
            && isset($_POST['sabt_sherkat']) && $_POST['sabt_sherkat'] != null
            && isset($_POST['nemune_mohr']) && $_POST['nemune_mohr'] != null
            && isset($_POST['madarek_hoviyati']) && $_POST['madarek_hoviyati'] != null
            && isset($_POST['price']) && $_POST['price'] != null
            && isset($_POST['date_farsi']) && $_POST['date_farsi'] != null
            && isset($_POST['telegram']) && $_POST['telegram'] != null
            && isset($_POST['ersal_barge_telegram']) && $_POST['ersal_barge_telegram'] != null
            && isset($_POST['ersal_payamak']) && $_POST['ersal_payamak'] != null
            && isset($_POST['ersal_email']) && $_POST['ersal_email'] != null
            && isset($_POST['datasanter']) && $_POST['datasanter'] != null
            && isset($_POST['phone']) && $_POST['phone'] != null
            && isset($_POST['name_domain']) && $_POST['name_domain'] != null
            && isset($_POST['id_domain']) && $_POST['id_domain'] != null
            && isset($_POST['id_host']) && $_POST['id_host'] != null
            && isset($_POST['mahale_sodur']) && $_POST['mahale_sodur'] != null
            && isset($_POST['domain_darid']) && $_POST['domain_darid'] != null
            && isset($_POST['host_darid']) && $_POST['host_darid'] != null
            && isset($_POST['type_domain']) && $_POST['type_domain'] != null
            && isset($_POST['code_enteqal_domain']) && $_POST['code_enteqal_domain'] != null
            && isset($_POST['dns']) && $_POST['dns'] != null
            && isset($_POST['dns2']) && $_POST['dns2'] != null
            && isset($_POST['modate_domain']) && $_POST['modate_domain'] != null


        ) {


            $date_ir = new jdf();
            $time = explode("/", $_POST['date_farsi']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $M = $time2[1] . '-';
            $D = $time2[2];
            $g = $Y . $M . $D;

            $model->date = date($g);

            $model->type = $_POST['type'];
            $model->id_user = $_POST['id_user'];
            $model->id_khadamat = $_POST['id_khadamat'];
            $model->name = $_POST['name'];
            $model->lastname = $_POST['lastname'];
            $model->namepedar = $_POST['namepedar'];
            $model->codemeli = $_POST['codemeli'];
            $model->shomareshenasname = $_POST['shomareshenasname'];
            $model->tarikh_tavalod = $_POST['tarikh_tavalod'];
            $model->cellphone = $_POST['cellphone'];
            $model->cellphone2 = $_POST['cellphone2'];
            $model->lng = $_POST['lng'];
            $model->lat = $_POST['lat'];
            $model->adress = $_POST['adress'];
            $model->codeposti = $_POST['codeposti'];
            $model->email = $_POST['email'];
            $model->name_sherkat = $_POST['name_sherkat'];
            $model->shenase_meli = $_POST['shenase_meli'];
            $model->sabt_sherkat = $_POST['sabt_sherkat'];
            $model->nemune_mohr = $_POST['nemune_mohr'];
            $model->madarek_hoviyati = $_POST['madarek_hoviyati'];
            $model->price = $_POST['price'];
            $model->date_farsi = $_POST['date_farsi'];
            $model->telegram = $_POST['telegram'];
            $model->ersal_barge_telegram = $_POST['ersal_barge_telegram'];
            $model->ersal_payamak = $_POST['ersal_payamak'];
            $model->ersal_email = $_POST['ersal_email'];
            $model->datasanter = $_POST['datasanter'];
            $model->phone = $_POST['phone'];
            $model->name_domain = $_POST['name_domain'];
            $model->id_domain = $_POST['id_domain'];
            $model->id_host = $_POST['id_host'];
            $model->mahale_sodur = $_POST['mahale_sodur'];
            $model->domain_darid = $_POST['domain_darid'];
            $model->host_darid = $_POST['host_darid'];
            $model->eshterak = $_POST['type'];
            $model->type_domain = $_POST['type_domain'];
            $model->code_enteqal_domain = $_POST['code_enteqal_domain'];
            $model->dns = $_POST['dns'];
            $model->dns2 = $_POST['dns2'];
            $model->modate_domain = $_POST['modate_domain'];




            if ($model->save(false)) {

                $model1 = Idc::find()->where(['id' => $model->id])->one();
                $model1->eshterak = $model1->eshterak . '_' . $model1->id;

                if ($model1->save(false)) {

                    if ($model->type == 'domain') {

                        if ($model->host_darid == 1) {

                            $mode2 = new Idc();

                            $mode2->date = $model->date;
                            $mode2->id_user = $_POST['id_user'];
                            $mode2->id_khadamat = $_POST['id_khadamat'];
                            $mode2->name = $_POST['name'];
                            $mode2->lastname = $_POST['lastname'];
                            $mode2->namepedar = $_POST['namepedar'];
                            $mode2->codemeli = $_POST['codemeli'];
                            $mode2->shomareshenasname = $_POST['shomareshenasname'];
                            $mode2->tarikh_tavalod = $_POST['tarikh_tavalod'];
                            $mode2->cellphone = $_POST['cellphone'];
                            $mode2->cellphone2 = $_POST['cellphone2'];
                            $mode2->lng = $_POST['lng'];
                            $mode2->lat = $_POST['lat'];
                            $mode2->adress = $_POST['adress'];
                            $mode2->codeposti = $_POST['codeposti'];
                            $mode2->email = $_POST['email'];
                            $mode2->name_sherkat = $_POST['name_sherkat'];
                            $mode2->shenase_meli = $_POST['shenase_meli'];
                            $mode2->sabt_sherkat = $_POST['sabt_sherkat'];
                            $mode2->nemune_mohr = $_POST['nemune_mohr'];
                            $mode2->madarek_hoviyati = $_POST['madarek_hoviyati'];
                            $mode2->price = $_POST['price'];
                            $mode2->date_farsi = $_POST['date_farsi'];
                            $mode2->telegram = $_POST['telegram'];
                            $mode2->ersal_barge_telegram = $_POST['ersal_barge_telegram'];
                            $mode2->ersal_payamak = $_POST['ersal_payamak'];
                            $mode2->ersal_email = $_POST['ersal_email'];
                            $mode2->datasanter = $_POST['datasanter'];
                            $mode2->phone = $_POST['phone'];
                            $mode2->name_domain = $_POST['name_domain'];
                            $mode2->id_domain = $_POST['id_domain'];
                            $mode2->id_host = $_POST['id_host'];
                            $mode2->mahale_sodur = $_POST['mahale_sodur'];
                            $mode2->domain_darid = $_POST['domain_darid'];
                            $mode2->host_darid = $_POST['host_darid'];
                            $mode2->type_domain = $_POST['type_domain'];
                            $mode2->code_enteqal_domain = $_POST['code_enteqal_domain'];
                            $mode2->dns = $_POST['dns'];
                            $mode2->dns2 = $_POST['dns2'];
                            $mode2->modate_domain = $_POST['modate_domain'];
                            $mode2->type = 'host';
                            $mode2->eshterak = 'host';

                            if ($mode2->save(false)) {

                                $model3 = Idc::find()->where(['id' => $mode2->id])->one();
                                $model3->eshterak = $model3->eshterak . '_' . $model3->id;
                                if ($model3->save(false)) {
//                $search=Idc::find()->where(['name_domain'=>$_POST['name_domain']])->andWhere(['type'=>'domain'])->one();
//                $search->delete();
                                    $sendOk['msg'] = 'انجام شد';
                                    $sendOk['result'] = 1;
                                    return $sendOk;
                                }
                            } else {

                                $sendOk['msg'] = 'host ذخیره نشد';
                                $sendOk['result'] = 0;
                                return $sendOk;
                            }


                        }
                        else{
                            $sendOk['msg'] = 'انجام شد';
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }

                    elseif ($model->type == 'host') {

                        if ($model->domain_darid == 1) {


                            $mode2 = new Idc();

                            $mode2->date = $model->date;
                            $mode2->id_user = $_POST['id_user'];
                            $mode2->id_khadamat = $_POST['id_khadamat'];
                            $mode2->name = $_POST['name'];
                            $mode2->lastname = $_POST['lastname'];
                            $mode2->namepedar = $_POST['namepedar'];
                            $mode2->codemeli = $_POST['codemeli'];
                            $mode2->shomareshenasname = $_POST['shomareshenasname'];
                            $mode2->tarikh_tavalod = $_POST['tarikh_tavalod'];
                            $mode2->cellphone = $_POST['cellphone'];
                            $mode2->cellphone2 = $_POST['cellphone2'];
                            $mode2->lng = $_POST['lng'];
                            $mode2->lat = $_POST['lat'];
                            $mode2->adress = $_POST['adress'];
                            $mode2->codeposti = $_POST['codeposti'];
                            $mode2->email = $_POST['email'];
                            $mode2->name_sherkat = $_POST['name_sherkat'];
                            $mode2->shenase_meli = $_POST['shenase_meli'];
                            $mode2->sabt_sherkat = $_POST['sabt_sherkat'];
                            $mode2->nemune_mohr = $_POST['nemune_mohr'];
                            $mode2->madarek_hoviyati = $_POST['madarek_hoviyati'];
                            $mode2->price = $_POST['price'];
                            $mode2->date_farsi = $_POST['date_farsi'];
                            $mode2->telegram = $_POST['telegram'];
                            $mode2->ersal_barge_telegram = $_POST['ersal_barge_telegram'];
                            $mode2->ersal_payamak = $_POST['ersal_payamak'];
                            $mode2->ersal_email = $_POST['ersal_email'];
                            $mode2->datasanter = $_POST['datasanter'];
                            $mode2->phone = $_POST['phone'];
                            $mode2->name_domain = $_POST['name_domain'];
                            $mode2->id_domain = $_POST['id_domain'];
                            $mode2->id_host = $_POST['id_host'];
                            $mode2->mahale_sodur = $_POST['mahale_sodur'];
                            $mode2->domain_darid = $_POST['domain_darid'];
                            $mode2->host_darid = $_POST['host_darid'];
                            $mode2->type_domain = $_POST['type_domain'];
                            $mode2->code_enteqal_domain = $_POST['code_enteqal_domain'];
                            $mode2->modate_domain = $_POST['modate_domain'];
                            $mode2->dns = $_POST['dns'];
                            $mode2->dns2 = $_POST['dns2'];
                            $mode2->type = 'domain';
                            $mode2->eshterak = 'domain';

                            if ($mode2->save(false)) {


//                                $search=Idc::find()->where(['name_domain'=>$_POST['name_domain']])->andWhere(['type'=>'domain'])->one();
//                                $search->delete();
                                $model3 = Idc::find()->where(['id' => $mode2->id])->one();
                                $model3->eshterak = $model3->eshterak . '_' . $model3->id;
                                if ($model3->save(false)) {

                                    $sendOk['msg'] = 'انجام شد';
                                    $sendOk['result'] = 1;
                                    return $sendOk;
                                }
                            } else {

                                $sendOk['msg'] = 'domain ذخیره نشد';
                                $sendOk['result'] = 0;
                                return $sendOk;
                            }


                        }

                        elseif($model->domain_darid == 0){
                            $sendOk['msg'] = 'انجام شد';
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{

                        $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                        $sendOk['result'] = 1;
                        return $sendOk;
                    }




                } else {
                    $sendOk['msg'] = '.خطا:عملیات با موفقیت انجام نشد.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }


            } else {
                $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                $sendOk['result'] = 0;

                return $sendOk;
            }


        } else {
            $sendOk['msg'] = 'عملیات با موفقیت انجام نشد.اطلاعات ارسالی ناقص می باشد';
            $sendOk['result'] = 0;
            return $sendOk;

        }

    }


    public function actionTest_tamdid_domain(){
        if(isset($_POST['name_domain']) && $_POST['name_domain']!=null
        && isset($_POST['type']) && $_POST['type']!=null
        && isset($_POST['tarikh_emruz']) && $_POST['tarikh_emruz']!=null
        ){
            if($_POST['type'] == 'domain'){
                $search=Idc::find()->where(['name_domain'=>$_POST['name_domain']])->one();
                if($search!=null){

                    $time = strtotime($search->date);

                   $modat=explode('_',$search->modate_domain ) ;
                    if( $modat['0'] == 'm' ){
                        $m=$modat['1'];
                        $newTime = $time +  $m *30 * 60 * 60 * 24 ;
                    }else{
                        $y=$modat['1'];
                        $newTime = $time +  $y *365 * 60 * 60 * 24 ;
                    }


                    $newDate = date('Y-m-d', $newTime);
                    $date1=date_create($newDate);
                    $date2=date_create($_POST['tarikh_emruz']);

                    if($date1 > $date2 ){
                        $datefa=new jdf();
                        $datefarsi=$datefa->date('Y/m/d');
                        $sendOk['msg']='فرصت داشته اید.'.$datefarsi.'زمان تمدید به اتمام رسیده است، شما تا تاریخ ';
                        $sendOk['result']=0;
                        return $sendOk;
                    }
                    else{

                        $datefa=new jdf();
                        $datefarsi=$datefa->date('Y/m/d');
                        $sendOk['msg']='تمدید خواخد شد'.$search->modate_domain.'به مدت'.$datefarsi.'دامنه شما از تاریخ';
                        $sendOk['result']=1;
                        return $sendOk;
                        
                    }

                }
            }
        }
        else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }
    }


//y= foroshe_tejari
// action done
    public function actionFactor_y()
    {
        $model = new Foroshtejary();
        if (isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['name_vahed_markaz']) && $_POST['name_vahed_markaz'] != null
            && isset($_POST['name_moteqazi']) && $_POST['name_moteqazi'] != null
            && isset($_POST['semat']) && $_POST['semat'] != null
            && isset($_POST['cellphone']) && $_POST['cellphone'] != null
            && isset($_POST['phone']) && $_POST['phone'] != null
            && isset($_POST['tedade_markaz']) && $_POST['tedade_markaz'] != null
            && isset($_POST['masahat']) && $_POST['masahat'] != null
            && isset($_POST['lng']) && $_POST['lng'] != null
            && isset($_POST['lat']) && $_POST['lat'] != null
            && isset($_POST['tedade_tabaqat']) && $_POST['tedade_tabaqat'] != null
            && isset($_POST['tajhizat']) && $_POST['tajhizat'] != null
            && isset($_POST['kodum_service']) && $_POST['kodum_service'] != null
            && isset($_POST['ertefa']) && $_POST['ertefa'] != null
            && isset($_POST['movafeq']) && $_POST['movafeq'] != null
            && isset($_POST['discripton']) && $_POST['discripton'] != null
            && isset($_POST['datefa']) && $_POST['datefa'] != null
            && isset($_POST['price']) && $_POST['price'] != null
            && isset($_POST['shahr']) && $_POST['shahr'] != null
            && isset($_POST['mdf']) && $_POST['mdf'] != null
        ) {


            $date_ir = new jdf();
            $time = explode("/", $_POST['datefa']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $M = $time2[1] . '-';
            $D = $time2[2];
            $g = $Y . $M . $D;

            $model->date = date($g);

            $model->type = $_POST['type'];
            $model->id_user = $_POST['id_user'];
            $model->name_vahed_markaz = $_POST['name_vahed_markaz'];
            $model->name_moteqazi = $_POST['name_moteqazi'];
            $model->semat = $_POST['semat'];
            $model->cellphone = $_POST['cellphone'];
            $model->phone = $_POST['phone'];
            $model->tedade_markaz = $_POST['tedade_markaz'];
            $model->masahat = $_POST['masahat'];
            $model->lng = $_POST['lng'];
            $model->lat = $_POST['lat'];
            $model->tedade_tabaqat = $_POST['tedade_tabaqat'];
            $model->tajhizat = $_POST['tajhizat'];
            $model->kodum_service = $_POST['kodum_service'];
            $model->ertefa = $_POST['ertefa'];
            $model->movafeq = $_POST['movafeq'];
            $model->discripton = $_POST['discripton'];
            $model->datefa = $_POST['datefa'];
            $model->price = $_POST['price'];
            $model->shahr = $_POST['shahr'];
            $model->mdf = $_POST['mdf'];
            $model->eshterak = $_POST['type'];

            if ($model->save(false)) {

                $model1 = Foroshtejary::find()->where(['id' => $model->id])->one();
                $model1->eshterak = $model1->eshterak . '_' . $model1->id;

                if ($model1->save(false)) {
                    $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                    $sendOk['result'] = 1;
                    return $sendOk;
                } else {
                    $sendOk['msg'] = '..ghjعملیات با موفقیت انجام نشد.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }


            } else {
                $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                $sendOk['result'] = 0;
                return $_POST;
            }


        } else {
            $sendOk['msg'] = 'عملیات با موفقیت انجام نشد.اطلاعات ارسالی ناقص می باشد';
            $sendOk['result'] = 0;
            return $sendOk;

        }
    }
    // z== ameliyate forosh
    //  g=foroshgahe mahali
    //z & g dar jadvale ameliyate forosh zakhire shodand
    // action done
    public function actionFactor_g_z()
    {

        $model = new Ameliyateforosh();

        if (isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['ostan']) && $_POST['ostan'] != null
            && isset($_POST['shahr']) && $_POST['shahr'] != null
            && isset($_POST['lng']) && $_POST['lng'] != null
            && isset($_POST['lat']) && $_POST['lat'] != null
            && isset($_POST['name']) && $_POST['name'] != null
            && isset($_POST['lastname']) && $_POST['lastname'] != null
            && isset($_POST['namepedar']) && $_POST['namepedar'] != null
            && isset($_POST['codemeli']) && $_POST['codemeli'] != null
            && isset($_POST['shomare_shenasname']) && $_POST['shomare_shenasname'] != null
            && isset($_POST['tarikh_tavalod']) && $_POST['tarikh_tavalod'] != null
            && isset($_POST['mahale_sodur']) && $_POST['mahale_sodur'] != null
            && isset($_POST['cellphone']) && $_POST['cellphone'] != null
            && isset($_POST['telegram1']) && $_POST['telegram1'] != null
            && isset($_POST['cellphone2']) && $_POST['cellphone2'] != null
            && isset($_POST['telegram2']) && $_POST['telegram2'] != null
            && isset($_POST['phone_majmue']) && $_POST['phone_majmue'] != null
            && isset($_POST['faks']) && $_POST['faks'] != null
            && isset($_POST['phone_majmue2']) && $_POST['phone_majmue2'] != null
            && isset($_POST['faks2']) && $_POST['faks2'] != null
            && isset($_POST['phone']) && $_POST['phone'] != null
            && isset($_POST['email']) && $_POST['email'] != null
            && isset($_POST['adress']) && $_POST['adress'] != null
            && isset($_POST['saat_az']) && $_POST['saat_az'] != null
            && isset($_POST['saat_ta']) && $_POST['saat_ta'] != null
            && isset($_POST['ax_kartmeli_ro']) && $_POST['ax_kartmeli_ro'] != null
            && isset($_POST['ax_kartmeli_posht']) && $_POST['ax_kartmeli_posht'] != null
            && isset($_POST['ax_modir1']) && $_POST['ax_modir1'] != null
            && isset($_POST['ax_modir2']) && $_POST['ax_modir2'] != null
            && isset($_POST['sayer']) && $_POST['sayer'] != null
            && isset($_POST['tarefe']) && $_POST['tarefe'] != null
            && isset($_POST['logo']) && $_POST['logo'] != null
            && isset($_POST['namaye_dakheli1']) && $_POST['namaye_dakheli1'] != null
            && isset($_POST['namaye_dakheli2']) && $_POST['namaye_dakheli2'] != null
            && isset($_POST['namaye_khareji1']) && $_POST['namaye_khareji1'] != null
            && isset($_POST['namaye_khareji2']) && $_POST['namaye_khareji2'] != null
            && isset($_POST['saat_kari']) && $_POST['saat_kari'] != null
            && isset($_POST['sayer2']) && $_POST['sayer2'] != null
            && isset($_POST['name_hozeye_faaliyat']) && $_POST['name_hozeye_faaliyat'] != null
            && isset($_POST['hamkari_ba_sherkat']) && $_POST['hamkari_ba_sherkat'] != null
            && isset($_POST['ashnaee_kodam_service']) && $_POST['ashnaee_kodam_service'] != null
            && isset($_POST['moqeiyate_makani']) && $_POST['moqeiyate_makani'] != null
            && isset($_POST['moqeiyate_tablo']) && $_POST['moqeiyate_tablo'] != null
            && isset($_POST['ax_emza']) && $_POST['ax_emza'] != null
            && isset($_POST['kharid_az_sherkat']) && $_POST['kharid_az_sherkat'] != null
            && isset($_POST['tavanaee_forosh_kodam_service']) && $_POST['tavanaee_forosh_kodam_service'] != null
            && isset($_POST['price']) && $_POST['price'] != null
            && isset($_POST['date_farsi']) && $_POST['date_farsi'] != null
            && isset($_POST['mahale']) && $_POST['mahale'] != null
            && isset($_POST['dastebandi_shoqli']) && $_POST['dastebandi_shoqli'] != null
            && isset($_POST['namayande_kodam_sherkat']) && $_POST['namayande_kodam_sherkat'] != null
            && isset($_POST['discription']) && $_POST['discription'] != null
            && isset($_POST['name_persenel']) && $_POST['name_persenel'] != null
            && isset($_POST['lastname_persenel']) && $_POST['lastname_persenel'] != null
            && isset($_POST['name_pedar_persenel']) && $_POST['name_pedar_persenel'] != null
            && isset($_POST['codemeli_persenel']) && $_POST['codemeli_persenel'] != null
            && isset($_POST['shomareshenasname_persenel']) && $_POST['shomareshenasname_persenel'] != null
            && isset($_POST['tarikhe_tavalod_persenel']) && $_POST['tarikhe_tavalod_persenel'] != null
            && isset($_POST['mahale_sodur_persenel']) && $_POST['mahale_sodur_persenel'] != null
            && isset($_POST['faaliyat_tamvaqt']) && $_POST['faaliyat_tamvaqt'] != null
            && isset($_POST['tavanaee_beruzresani_mahsulat']) && $_POST['tavanaee_beruzresani_mahsulat'] != null
            && isset($_POST['aya_berand']) && $_POST['aya_berand'] != null
            && isset($_POST['name_berand']) && $_POST['name_berand'] != null
            && isset($_POST['logo_berand']) && $_POST['logo_berand'] != null
            && isset($_POST['tavanee_ekhtiyargozashtan_mahsulat']) && $_POST['tavanee_ekhtiyargozashtan_mahsulat'] != null
            && isset($_POST['moaref']) && $_POST['moaref'] != null
            && isset($_POST['ax_kartmeli_modir']) && $_POST['ax_kartmeli_modir'] != null
            && isset($_POST['ax_kartmeli_persenel']) && $_POST['ax_kartmeli_persenel'] != null
            && isset($_POST['ax_tabloye_biruni']) && $_POST['ax_tabloye_biruni'] != null
            && isset($_POST['lng2']) && $_POST['lng2'] != null
            && isset($_POST['lat2']) && $_POST['lat2'] != null
        ) {


            $date_ir = new jdf();
            $time = explode("/", $_POST['date_farsi']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $M = $time2[1] . '-';
            $D = $time2[2];
            $g = $Y . $M . $D;

            $model->date = date($g);

            $model->type = $_POST['type'];
            $model->id_user = $_POST['id_user'];
            $model->ostan = $_POST['ostan'];
            $model->shahr = $_POST['shahr'];
            $model->lng = $_POST['lng'];
            $model->lat = $_POST['lat'];
            $model->name = $_POST['name'];
            $model->lastname = $_POST['lastname'];
            $model->namepedar = $_POST['namepedar'];
            $model->codemeli = $_POST['codemeli'];
            $model->shomare_shenasname = $_POST['shomare_shenasname'];
            $model->tarikh_tavalod = $_POST['tarikh_tavalod'];
            $model->mahale_sodur = $_POST['mahale_sodur'];
            $model->cellphone = $_POST['cellphone'];
            $model->telegram1 = $_POST['telegram1'];
            $model->cellphone2 = $_POST['cellphone2'];
            $model->telegram2 = $_POST['telegram2'];
            $model->phone_majmue = $_POST['phone_majmue'];
            $model->faks = $_POST['faks'];
            $model->phone_majmue2 = $_POST['phone_majmue2'];
            $model->faks2 = $_POST['faks2'];
            $model->phone = $_POST['phone'];
            $model->email = $_POST['email'];
            $model->adress = $_POST['adress'];
            $model->saat_az = $_POST['saat_az'];
            $model->saat_ta = $_POST['saat_ta'];
            $model->ax_kartmeli_ro = $_POST['ax_kartmeli_ro'];
            $model->ax_kartmeli_posht = $_POST['ax_kartmeli_posht'];
            $model->ax_modir1 = $_POST['ax_modir1'];
            $model->ax_modir2 = $_POST['ax_modir2'];
            $model->sayer = $_POST['sayer'];
            $model->tarefe = $_POST['tarefe'];
            $model->logo = $_POST['logo'];
            $model->namaye_dakheli1 = $_POST['namaye_dakheli1'];
            $model->namaye_dakheli2 = $_POST['namaye_dakheli2'];
            $model->namaye_khareji1 = $_POST['namaye_khareji1'];
            $model->namaye_khareji2 = $_POST['namaye_khareji2'];
            $model->saat_kari = $_POST['saat_kari'];
            $model->sayer2 = $_POST['sayer2'];
            $model->name_hozeye_faaliyat = $_POST['name_hozeye_faaliyat'];
            $model->hamkari_ba_sherkat = $_POST['hamkari_ba_sherkat'];
            $model->ashnaee_kodam_service = $_POST['ashnaee_kodam_service'];
            $model->moqeiyate_makani = $_POST['moqeiyate_makani'];
            $model->moqeiyate_tablo = $_POST['moqeiyate_tablo'];
            $model->ax_emza = $_POST['ax_emza'];
            $model->kharid_az_sherkat = $_POST['kharid_az_sherkat'];
            $model->tavanaee_forosh_kodam_service = $_POST['tavanaee_forosh_kodam_service'];
            $model->price = $_POST['price'];
            $model->date_farsi = $_POST['date_farsi'];
            $model->mahale = $_POST['mahale'];
            $model->dastebandi_shoqli = $_POST['dastebandi_shoqli'];
            $model->namayande_kodam_sherkat = $_POST['namayande_kodam_sherkat'];
            $model->discription = $_POST['discription'];
            $model->name_persenel = $_POST['name_persenel'];
            $model->lastname_persenel = $_POST['lastname_persenel'];
            $model->name_pedar_persenel = $_POST['name_pedar_persenel'];
            $model->codemeli_persenel = $_POST['codemeli_persenel'];
            $model->shomareshenasname_persenel = $_POST['shomareshenasname_persenel'];
            $model->tarikhe_tavalod_persenel = $_POST['tarikhe_tavalod_persenel'];
            $model->mahale_sodur_persenel = $_POST['mahale_sodur_persenel'];
            $model->faaliyat_tamvaqt = $_POST['faaliyat_tamvaqt'];
            $model->tavanaee_beruzresani_mahsulat = $_POST['tavanaee_beruzresani_mahsulat'];
            $model->aya_berand = $_POST['aya_berand'];
            $model->name_berand = $_POST['name_berand'];
            $model->logo_berand = $_POST['logo_berand'];
            $model->tavanee_ekhtiyargozashtan_mahsulat = $_POST['tavanee_ekhtiyargozashtan_mahsulat'];
            $model->moaref = $_POST['moaref'];
            $model->ax_kartmeli_modir = $_POST['ax_kartmeli_modir'];
            $model->ax_kartmeli_persenel = $_POST['ax_kartmeli_persenel'];
            $model->ax_tabloye_biruni = $_POST['ax_tabloye_biruni'];
            $model->lng2 = $_POST['lng2'];
            $model->lat2 = $_POST['lat2'];
            $model->eshterak = $_POST['type'];

            if ($model->save(false)) {

                $model1 = Ameliyateforosh::find()->where(['id' => $model->id])->one();
                $model1->eshterak = $model1->eshterak . '_' . $model1->id;

                if ($model1->save(false)) {
                    $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                    $sendOk['result'] = 1;
                    return $sendOk;
                } else {
                    $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }


            } else {
                $sendOk['msg'] = '..عملیات با موفقیت انجام نشد.';
                $sendOk['result'] = 0;
                return $sendOk;
            }


        } else {
            $sendOk['msg'] = 'عملیات با موفقیت انجام نشد.اطلاعات ارسالی ناقص می باشد';
            $sendOk['result'] = 0;
            return $sendOk;

        }


    }

    //action done

    public function actionLogin()
    {

        $p = Yii::$app->getRequest()->getBodyParams();
        if (isset($_POST['username']) && $_POST['username'] != null && isset($_POST['password']) && $_POST['password'] != null
            && isset($_POST['semat']) && $_POST['semat'] != null
        ) {
            $username = $p['username'];
            $password = $p['password'];
            $user = User::findByUsername($username);

            if ($user != null) {
                $profil = Profile::find()->where(['id_user' => $user->id])->one();
                if ($user->validatePassword($password)) {
                    Yii::$app->getUser()->login($user);
                    $send['id_user'] = $user->id;
                    if ($profil->semat == $_POST['semat']) {

                        $send['id'] = $profil->id;
                        $send['name'] = $profil->name;
                        $send['lastname'] = $profil->lastname;
                        $send['namepedar'] = $profil->namepedar;
                        $send['codemeli'] = $profil->codemeli;
                        $send['cellphone'] = $profil->cellphone;
                        $send['phone'] = $profil->phone;
                        $send['saatkari_az'] = $profil->saatkari_az;
                        $send['saatkari_ta'] = $profil->saatkari_ta;
                        $send['shomarepersenel'] = $profil->shomarepersenel;
                        $send['ax_perseneli'] =Yii::$app->request->hostInfo."/upload/profil/ax_perseneli/". $profil->ax_perseneli;
                        $send['ax_kartmeli'] =Yii::$app->request->hostInfo."/upload/profil/ax_kartmeli/". $profil->ax_kartmeli;
                        $send['adress'] = $profil->adress;
                        $send['tarikhsabt_karmand2'] = $profil->tarikhsabt_karmand2;
                        $send['shahr'] = $profil->shahr;
                        $send['ostan'] = $profil->ostan;
                        $send['id_mantaqe'] = $profil->id_mantaqe;




                        $markaz = TblPhone::find()->where(['id' => $profil->id_phone])->one();
                        if ($markaz != null) {
                            $send['name_markaz'] = $markaz->name_markaz;
                        } else {
                            $send['name_markaz'] = 'موجود نیست';
                        }




                        $send['result'] = 1;
                        return $send;
                    } else {
                        $send['result'] = 0;
                        $send['msg'] = "سمت وارد شده اشتباه است";
                        return $send;
                    }


                } else {
                    $send['result'] = 0;
                    $send['msg'] = "یوزر و پسورد اشتباه است";
                    return $send;

                }
            } else {
                $send['result'] = 0;
                $send['msg'] = "هیچ کاربری با این مشخصات یافت نشد";
                return $send;

            }

        } else {
            $send['msg'] = "داده های ارسالی اشتباه است";
            $send['result'] = 0;
            return $send;
        }
    }
// در این اکشن تاریخ روز و اخرین اخبار و اخرین سرویس ارسال می شود
// action done

    public function actionPost()
    {

        if (isset($_POST['semat']) && $_POST['semat'] != null) {


            $post1 = Post::find()->where(['enableview' => 1])->all();




            $date1=new jdf();
            $date=$date1->date('Y/m/d');


            if ($post1 != null) {


                foreach ($post1 as $post) {


                    if ($post->enable == $_POST['semat'] || $post->enable == 5) {

                        $sendList['id'] = $post->id;
                        $sendList['name'] = $post->name;
                        $sendList['text'] = $post->text;
                        $sendList['category'] = $post->category;
                        $sendList['img'] = Yii::$app->request->hostInfo . "/upload/post/" . $post->img;
                        $sendFull[] = $sendList;

                    }
//    else {
//
//                           $send['post'] = 'موجود نیست';
//                           $send['result'] = 0;
//                           return $send;
//
//
//                       }


                }

                $send['post'] = $sendFull;
                $send['datefarsi']= $date;
                $send['date']= date('Y/m/d');
                $send['result'] = 1;
                return $send;
            } else {
                $send['msg'] = 'پست موجود نیست.';
                $send['datefarsi']= $date;
                $send['date']= date('Y/m/d');
                $send['result'] = 0;
                return $send;
            }


        } else {
            $send['msg'] = 'سمت را وارد کنید';
            $send['result'] = 0;
            return $send;
        }
    }



    public function actionTarget_froshekoli()
    {

        if (isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['az_tarikh']) && $_POST['az_tarikh'] != null
            && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh'] != null
        ) {



            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);

                $factoradsl = Adsl::find()->where(['id_user' => $_POST['id_user']])->all();
                $adsl = 0;
                $vdsl = 0;
                $owa = 0;
                $td = 0;
                $iptv = 0;
                if ($factoradsl != null) {
                    $adsl = 0;
                    $vdsl = 0;
                    $owa = 0;
                    $td = 0;
                    $iptv = 0;

                    foreach ($factoradsl as $fa) {


                        if ($fa->date >= $az_date && $fa->date <=  $ta_date) {


                            if ($fa->type == 'adsl') {
                                $adsl++;
                            } elseif ($fa->type == 'vdsl') {
                                $vdsl++;
                            } elseif ($fa->type == 'owa') {
                                $owa++;
                            } elseif ($fa->type == 'td-lte') {
                                $td++;
                            } elseif ($fa->type == 'iptv') {
                                $iptv++;
                            }

                        }


                    }

                    $send['adsl'] = $adsl;
                    $send['vdsl'] = $vdsl;
                    $send['owa'] = $owa;
                    $send['td-lte'] = $td;
                    $send['iptv'] = $iptv;
                    $sendOk['tahaqoq'] = $send;
                } else {
                    $send['adsl'] = $adsl;
                    $send['vdsl'] = $vdsl;
                    $send['owa'] = $owa;
                    $send['td-lte'] = $td;
                    $send['iptv'] = $iptv;
                    $sendOk['tahaqoq'] = $send;
                }
                $factorngn = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->all();
                $ngn = 0;
                $mvno = 0;
                $cdn = 0;
                $vas = 0;
                if ($factorngn != null) {


                    foreach ($factorngn as $fn) {
                        if ($fn->type == 'ngn') {
                            $ngn++;
                        } elseif ($fn->type == 'mvno') {
                            $mvno++;
                        } elseif ($fn->type == 'cdn') {
                            $cdn++;
                        } elseif ($fn->type == 'vas') {
                            $vas++;
                        }
                    }
                    $send['ngn'] = $ngn;
                    $send['mvno'] = $mvno;
                    $send['cdn'] = $cdn;
                    $send['vas'] = $vas;
                    $sendOk['tahaqoq'] = $send;
                } else {
                    $send['ngn'] = $ngn;
                    $send['mvno'] = $mvno;
                    $send['cdn'] = $cdn;
                    $send['vas'] = $vas;
                    $sendOk['tahaqoq'] = $send;
                }

                $factoridc = Idc::find()->where(['id_user' => $_POST['id_user']])->all();
                $idc = 0;
                $vpn = 0;
                $x = 0;
                $domain = 0;
                $host = 0;
                if ($factoridc != null) {


                    foreach ($factoridc as $fi) {
                        if ($fi->type == 'idc') {
                            $idc++;
                        } elseif ($fi->type == 'vpn') {
                            $vpn++;
                        } elseif ($fi->type == 'x') {
                            $x++;
                        } elseif ($fi->type == 'domain') {
                            $domain++;
                        } elseif ($fi->type == 'host') {
                            $host++;
                        }

                    }
                    $send['idc'] = $idc;
                    $send['vpn'] = $vpn;
                    $send['x'] = $x;
                    $send['domain'] = $domain;
                    $send['host'] = $host;
                    $sendOk['tahaqoq'] = $send;

                } else {
                    $send['idc'] = $idc;
                    $send['vpn'] = $vpn;
                    $send['x'] = $x;
                    $send['domain'] = $domain;
                    $send['host'] = $host;
                    $sendOk['tahaqoq'] = $send;
                }

                $factory = Foroshtejary::find()->where(['id_user' => $_POST['id_user']])->all();
                $y = 0;
                if ($factory != null) {
                    foreach ($factory as $fy) {
                        if ($fy->type == 'y') {
                            $y++;
                        }
                    }
                    $send['y'] = $y;
                    $sendOk['tahaqoq'] = $send;
                } else {
                    $send['y'] = $y;
                    $sendOk['tahaqoq'] = $send;
                }

                $factorg_z = Ameliyateforosh::find()->where(['id_user' => $_POST['id_user']])->all();
                $z = 0;
                $g = 0;
                if ($factorg_z != null) {
                    foreach ($factorg_z as $fgz) {
                        if ($fgz->type == 'g') {
                            $g++;
                        } elseif ($fgz->type == 'z') {
                            $z++;
                        }
                    }
                    $send['g'] = $g;
                    $send['z'] = $z;
//                    $sendOk['tahaqoq']=$send;

                } else {
                    $send['g'] = $g;
                    $send['z'] = $z;
//                    $sendOk['tahaqoq']=$send;
                }
                $targetadsl = Tbltarget::find()->where(['id_user' => $_POST['id_user']])->all();

                $adsl = 0;
                $vdsl = 0;
                $owa = 0;
                $td = 0;
                $iptv = 0;
                $ngn = 0;
                $mvno = 0;
                $cdn = 0;
                $vas = 0;
                $idc = 0;
                $vpn = 0;
                $x = 0;
                $domain = 0;
                $host = 0;
                $y = 0;
                $g = 0;
                $z = 0;
                if ($targetadsl != null) {


                    foreach ($targetadsl as $ta) {

                        if ($ta->date >= $az_date && $ta->ta_date <= $ta_date) {


                            if ($ta->sabtnam == 'ADSL') {
                                $adsl = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'VDSL') {
                                $vdsl = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'OWA') {
                                $owa = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'TD-LTE') {
                                $td = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'IPTV') {
                                $iptv = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'NGN') {
                                $ngn = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'MVNO') {
                                $mvno = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'CDN') {
                                $cdn = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'VAS') {
                                $vas = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'IDC') {
                                $idc = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'VPN') {
                                $vpn = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'X') {
                                $x = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'DOMAIN') {
                                $domain = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'HOST') {
                                $host = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'Y') {
                                $y = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'G') {
                                $g = $ta->tagetforosh_mahane;
                            } elseif ($ta->sabtnam == 'Z') {
                                $z = $ta->tagetforosh_mahane;
                            }
                        }

                    }
                    $send1['adsl'] = $adsl;
                    $send1['vdsl'] = $vdsl;
                    $send1['owa'] = $owa;
                    $send1['td-lte'] = $td;
                    $send1['iptv'] = $iptv;
                    $send1['ngn'] = $ngn;
                    $send1['mvno'] = $mvno;
                    $send1['cdn'] = $cdn;
                    $send1['vas'] = $vas;
                    $send1['idc'] = $idc;
                    $send1['vpn'] = $vpn;
                    $send1['x'] = $x;
                    $send1['domain'] = $domain;
                    $send1['host'] = $host;
                    $send1['y'] = $y;
                    $send1['g'] = $g;
                    $send1['z'] = $z;
//                    $sendOk['hadaf']=$send1;


                } else {
                    $send1['adsl'] = $adsl;
                    $send1['vdsl'] = $vdsl;
                    $send1['owa'] = $owa;
                    $send1['td-lte'] = $td;
                    $send1['iptv'] = $iptv;
                    $send1['ngn'] = $ngn;
                    $send1['mvno'] = $mvno;
                    $send1['cdn'] = $cdn;
                    $send1['vas'] = $vas;
                    $send1['idc'] = $idc;
                    $send1['vpn'] = $vpn;
                    $send1['x'] = $x;
                    $send1['domain'] = $domain;
                    $send1['host'] = $host;
                    $send1['y'] = $y;
                    $send1['g'] = $g;
                    $send1['z'] = $z;
//                    $sendOk['hadaf']=$send1;
                }

                $send2['adsl'] = $send['adsl'] - $send1['adsl'];
                $send2['vdsl'] = $send['vdsl'] - $send1['vdsl'];
                $send2['owa'] = $send['owa'] - $send1['owa'];
                $send2['td-lte'] = $send['td-lte'] - $send1['td-lte'];
                $send2['iptv'] = $send['iptv'] - $send1['iptv'];
                $send2['ngn'] = $send['ngn'] - $send1['ngn'];
                $send2['mvno'] = $send['mvno'] - $send1['mvno'];
                $send2['cdn'] = $send['cdn'] - $send1['cdn'];
                $send2['vas'] = $send['vas'] - $send1['vas'];
                $send2['idc'] = $send['idc'] - $send1['idc'];
                $send2['vpn'] = $send['vpn'] - $send1['vpn'];
                $send2['x'] = $send['x'] - $send1['x'];
                $send2['domain'] = $send['domain'] - $send1['domain'];
                $send2['host'] = $send['host'] - $send1['host'];
                $send2['y'] = $send['y'] - $send1['y'];
                $send2['g'] = $send['g'] - $send1['g'];
                $send2['z'] = $send['z'] - $send1['z'];
//                $sendOk['enheraf_forosh']=$send2;

                $send3['adsl'] = 100 + ($send['adsl'] - $send1['adsl']);
                $send3['vdsl'] = 100 + ($send['vdsl'] - $send1['vdsl']);
                $send3['owa'] = 100 + ($send['owa'] - $send1['owa']);
                $send3['td-lte'] = 100 + ($send['td-lte'] - $send1['td-lte']);
                $send3['iptv'] = 100 + ($send['iptv'] - $send1['iptv']);
                $send3['ngn'] = 100 + ($send['ngn'] - $send1['ngn']);
                $send3['mvno'] = 100 + ($send['mvno'] - $send1['mvno']);
                $send3['cdn'] = 100 + ($send['cdn'] - $send1['cdn']);
                $send3['vas'] = 100 + ($send['vas'] - $send1['vas']);
                $send3['idc'] = 100 + ($send['idc'] - $send1['idc']);
                $send3['vpn'] = 100 + ($send['vpn'] - $send1['vpn']);
                $send3['x'] = 100 + ($send['x'] - $send1['x']);
                $send3['domain'] = 100 + ($send['domain'] - $send1['domain']);
                $send3['host'] = 100 + ($send['host'] - $send1['host']);
                $send3['y'] = 100 + ($send['y'] - $send1['y']);
                $send3['g'] = 100 + ($send['g'] - $send1['g']);
                $send3['z'] = 100 + ($send['z'] - $send1['z']);
//                $sendOk['enheraf']=$send3;

         
                        
             



                $sendfull['adsl'] = $send['adsl'] . ',' . $send1['adsl'] . ',' . $send2['adsl'] . ',' . $send3['adsl']. ',' . $send3['adsl'];
                $sendfull['vdsl'] = $send['vdsl'] . ',' . $send1['vdsl'] . ',' . $send2['vdsl'] . ',' . $send3['vdsl']. ',' . $send3['adsl'];
                $sendfull['owa'] = $send['owa'] . ',' . $send1['owa'] . ',' . $send2['owa'] . ',' . $send3['owa']. ',' . $send3['adsl'];
                $sendfull['td-lte'] = $send['td-lte'] . ',' . $send1['td-lte'] . ',' . $send2['td-lte'] . ',' . $send3['td-lte']. ',' . $send3['adsl'];
                $sendfull['iptv'] = $send['iptv'] . ',' . $send1['iptv'] . ',' . $send2['iptv'] . ',' . $send3['iptv']. ',' . $send3['adsl'];
                $sendfull['ngn'] = $send['ngn'] . ',' . $send1['ngn'] . ',' . $send2['ngn'] . ',' . $send3['ngn']. ',' . $send3['adsl'];
                $sendfull['mvno'] = $send['mvno'] . ',' . $send1['mvno'] . ',' . $send2['mvno'] . ',' . $send3['mvno']. ',' . $send3['adsl'];
                $sendfull['cdn'] = $send['cdn'] . ',' . $send1['cdn'] . ',' . $send2['cdn'] . ',' . $send3['cdn']. ',' . $send3['adsl'];
                $sendfull['vas'] = $send['vas'] . ',' . $send1['vas'] . ',' . $send2['vas'] . ',' . $send3['vas']. ',' . $send3['adsl'];
                $sendfull['idc'] = $send['idc'] . ',' . $send1['idc'] . ',' . $send2['idc'] . ',' . $send3['idc']. ',' . $send3['adsl'];
                $sendfull['vpn'] = $send['vpn'] . ',' . $send1['vpn'] . ',' . $send2['vpn'] . ',' . $send3['vpn']. ',' . $send3['adsl'];
                $sendfull['x'] = $send['x'] . ',' . $send1['x'] . ',' . $send2['x'] . ',' . $send3['x']. ',' . $send3['adsl'];
                $sendfull['domain'] = $send['domain'] . ',' . $send1['domain'] . ',' . $send2['domain'] . ',' . $send3['domain']. ',' . $send3['adsl'];
                $sendfull['host'] = $send['host'] . ',' . $send1['host'] . ',' . $send2['host'] . ',' . $send3['host']. ',' . $send3['adsl'];
                $sendfull['y'] = $send['y'] . ',' . $send1['y'] . ',' . $send2['y'] . ',' . $send3['y']. ',' . $send3['adsl'];
                $sendfull['g'] = $send['g'] . ',' . $send1['g'] . ',' . $send2['g'] . ',' . $send3['g']. ',' . $send3['adsl'];
                $sendfull['z'] = $send['z'] . ',' . $send1['z'] . ',' . $send2['z'] . ',' . $send3['z']. ',' . $send3['adsl'];

                $sendfull['result']=1;
                return $sendfull;

//            }
//            else {
//
//                $sendOk['msg'] = 'بازه زمانی تاریخ وارد شده صحیح نمی باشد.';
//                $sendOk['result'] = 0;
//                return $sendOk;
//            }


        }
        else{

            $sendOk['msg']='اطلاعات ارسالی ناقص است.';
            $sendOk['result']=0;
            return $sendOk;
        }

    }

    

    public function actionTarget_markazehadaf()
    {

        if (isset($_POST['id_user']) && $_POST['id_user']
            && isset($_POST['az_tarikh']) && $_POST['az_tarikh'] != null
            && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh'] != null
        ) {



            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);

            $target_name_markaz=Tbltarget::find()->where(['id_user'=>$_POST['id_user']])->all();
            $name_markaz='';
            $name_markaz1='';
            if( $target_name_markaz!= null){
                
               foreach($target_name_markaz as $tnm){

                   if($tnm->sabtnam == 'adsl' || $tnm->sabtnam == 'vdsl' || $tnm->sabtnam == 'z'){

                       if($az_date >= $tnm->date &&  $az_date <= $tnm->ta_date || $ta_date >= $tnm->date &&  $ta_date <= $tnm->ta_date ){

                           $name_markaz .=$tnm->name_markaz.'_';




                       }
                   }else{

                       if($az_date >= $tnm->date &&  $az_date <= $tnm->ta_date || $ta_date >= $tnm->date &&  $ta_date <= $tnm->ta_date ){


                           $name_markaz1 .=$tnm->name_mantaqe.'_';

                       }

                   }



               }
                
            }
            else{
              
            }
            
            
            
        }else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }

    }
    
//action down
    public function actionGozaresh_sabtnami()
    {


        if (
            isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['az_tarikh']) && $_POST['az_tarikh'] != null
            && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh'] != null
        ) {



            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);
//            if ($_POST['az_tarikh'] <= $_POST['ta_tarikh']) {

                if ($_POST['type'] == 'adsl') {


                    $all = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'adsl'])->all();
                    if ($all != null) {

                        foreach ($all as $a) {

                                $Ok=0;

                            if ($a->date >= $az_date && $a->date <= $ta_date) {

                                $Ok=1;

                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['adsl'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }

                        if($Ok == 0){
                            $sendOk['adsl'] = $send1;
                            $sendOk['result'] =0;
                            return $sendOk;
                        }else{

                            $sendOk['adsl'] = $sendList;
                            $sendOk['result'] =1;
                            return $sendOk;
                        }

                    }
                    else{
                        $sendOk['adsl'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                }
                elseif ($_POST['type'] == 'vdsl') {

                    $all = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'vdsl'])->all();
                    if ($all != null) {

                        $Ok=0;
                        foreach ($all as $a) {


                            if ($a->date_farsi >= $_POST['az_tarikh'] && $a->date_farsi <= $_POST['ta_tarikh']) {
$Ok=1;

                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['vdsl'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }

                        if($Ok == 0){
                            $sendOk['vdsl'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['vdsl'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }

                    }
                    else{
                        $sendOk['vdsl'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'owa') {

                    $all = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'owa'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {
                                $Ok=1;

                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['owa'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }if($Ok== 0){

                            $sendOk['owa'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['owa'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }

                    }
                    else{
                        $sendOk['owa'] = 'موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'td-lte') {

                    $all = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'td-lte'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date_farsi <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['td'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if($Ok == 0){
                            $sendOk['td'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['td'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['td'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'iptv') {

                    $all = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'iptv'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['iptv'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if($Ok == 0){
                            $sendOk['iptv'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['iptv'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['iptv'] = 'موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'ngn') {

                    $all = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'ngn'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['ngn'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['ngn'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['ngn'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }

                    }
                    else{
                        $sendOk['ngn'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'mvno') {

                    $all = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'mvno'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {

$Ok=1;
                            if ($a->date >= $az_date && $a->date <= $ta_date) {


                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['mvno'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['mvno'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['mvno'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['mvno'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'cdn') {

                    $all = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'cdn'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['cdn'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['cdn'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['cdn'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['cdn'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'vas') {

                    $all = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'vas'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date>= $az_date && $a->date <= $ta_date) {
$Ok=1;

                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['vas'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['vas'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['vas'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['vas'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'idc') {

                    $all = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'idc'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {
$Ok=1;

                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['idc'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['idc'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['idc'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['idc'] = 'موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'vpn') {

                    $all = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'vpn'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {
$Ok=1;

                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['vpn'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['vpn'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['vpn'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['vpn'] = 'موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'x') {

                    $all = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'x'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['x'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['x'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['x'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['x'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'domain')

                {

                    $all = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'domain'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date>= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['domain'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }

                        if( $Ok == 0){
                            $sendOk['domain'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['domain'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['domain'] = 'در این بازه زمانی فیلدی موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'host') {

                    $all = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'host'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['host'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['host'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['host'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['host'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'y') {

                    $all = Foroshtejary::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'y'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date>= $az_date && $a->date<= $ta_date) {
$Ok=1;

                                $send['time'] = $a->datefa;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name_moteqazi;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['y'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['y'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['y'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['y'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'g') {

                    $all = Ameliyateforosh::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'g'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['g'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['g'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['g'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['g'] = ' موجود نیست';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
                elseif ($_POST['type'] == 'z') {

                    $all = Ameliyateforosh::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'z'])->all();
                    if ($all != null) {
$Ok=0;
                        foreach ($all as $a) {


                            if ($a->date >= $az_date && $a->date <= $ta_date) {

$Ok=1;
                                $send['time'] = $a->date_farsi;
                                $send['eshterak'] = $a->eshterak;
                                $send['name'] = $a->name . $a->lastname;
                                $send['vaziyat'] = 0;
                                $sendList[] = $send;
                            }
                            else{
                                $send1['z'] = 'در این بازه زمانی فیلدی موجود نیست';

                            }

                        }
                        if( $Ok == 0){
                            $sendOk['z'] = $send1;
                            $sendOk['result'] = 0;
                            return $sendOk;
                        }else{
                            $sendOk['z'] = $sendList;
                            $sendOk['result'] = 1;
                            return $sendOk;
                        }
                    }
                    else{
                        $sendOk['z'] = 'موجود نیست ';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }
                }
            else{
                $sendOk['msg']='اطلاعات ارسالی نادرست می باشد';
                $sendOk['result']=0;
                return $sendOk;
            }

//            }
//            else {
//
//                $sendOk['msg'] = 'بازه زمانی تاریخ وارد شده صحیح نمی باشد.';
//                $sendOk['result'] = 0;
//                return $sendOk;
//
//
//            }


        }
        else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد';
            $sendOk['result']=0;
            return $sendOk;
        }


    }
// action done
    public function actionPursant()
    {

        if (
            isset($_POST['id_user']) && $_POST['id_user'] != null
            && isset($_POST['type']) && $_POST['type'] != null
            && isset($_POST['az_tarikh']) && $_POST['az_tarikh'] != null
            && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh'] != null
        ) {

            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);

//            if ($_POST['az_tarikh'] <= $_POST['ta_tarikh']) {


                if ($_POST['type'] == 'adsl') {

                    $pursantadsl = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'adsl'])->all();

                    $adsl = 0;
                    $mande = 0;
                    $modemadsl = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $adsl++;

                                $explode = explode(',', $pa->id_added);
                                $count = count($explode);

                                for ($i = 0; $i < $count; $i++) {

                                    $x = TblAddedInformation::find()->where(['sabtnam' => 'ADSL'])->andWhere(['id' => $explode[$i]])->all();

                                    if ($x != null) {

                                        foreach ($x as $x1) {


                                            if ($x1->name == 'مودم') {
                                                $modemadsl++;
                                            } elseif ($x1->name == 'نصب') {
                                                $nasbadsl++;
                                            }

                                        }
                                    }
                                }


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }


                        }
                        $send['kol'] = $adsl;
                        $send['tahvil'] = 10;
                        $send['modem'] = $modemadsl;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['adsl'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['adsl'] = 'کاربر گرامی  هیچ فاکتور adsl برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'vdsl') {

                    $pursantadsl = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'vdsl'])->all();

                    $vdsl = 0;
                    $mande = 0;
                    $modemadsl = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $_POST['ta_tarikh']) {


                                $vdsl++;

                                $explode = explode(',', $pa->id_added);
                                $count = count($explode);

                                for ($i = 0; $i < $count; $i++) {

                                    $x = TblAddedInformation::find()->where(['sabtnam' => 'VDSL'])->andWhere(['id' => $explode[$i]])->all();

                                    if ($x != null) {

                                        foreach ($x as $x1) {


                                            if ($x1->name == 'مودم') {
                                                $modemadsl++;
                                            } elseif ($x1->name == 'نصب') {
                                                $nasbadsl++;
                                            }

                                        }
                                    }
                                }


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $vdsl;
                        $send['tahvil'] = 10;
                        $send['modem'] = $modemadsl;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['vdsl'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['vdsl'] = 'کاربر گرامی  هیچ فاکتور vdsl برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }

                } 
                elseif ($_POST['type'] == 'td-lte') {

                    $pursantadsl = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'td-lte'])->all();

                    $td = 0;
                    $mande = 0;
                    $modemadsl = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $td++;

                                $explode = explode(',', $pa->id_added);
                                $count = count($explode);

                                for ($i = 0; $i < $count; $i++) {

                                    $x = TblAddedInformation::find()->where(['sabtnam' => 'TD-LTE'])->andWhere(['id' => $explode[$i]])->all();

                                    if ($x != null) {

                                        foreach ($x as $x1) {


                                            if ($x1->name == 'مودم') {
                                                $modemadsl++;
                                            } elseif ($x1->name == 'نصب') {
                                                $nasbadsl++;
                                            }

                                        }
                                    }
                                }


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $td;
                        $send['tahvil'] = 10;
                        $send['modem'] = $modemadsl;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['td-lte'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['td-lte'] = 'کاربر گرامی  هیچ فاکتور td-lte برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                }
                elseif ($_POST['type'] == 'owa') {

                    $pursantadsl = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'owa'])->all();

                    $owa = 0;
                    $mande = 0;
                    $tajhizat = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $owa++;

                                $explode = explode(',', $pa->id_added);
                                $count = count($explode);

                                for ($i = 0; $i < $count; $i++) {

                                    $x = TblAddedInformation::find()->where(['sabtnam' => 'OWA'])->andWhere(['id' => $explode[$i]])->all();

                                    if ($x != null) {

                                        foreach ($x as $x1) {


                                            if ($x1->name == 'تجهیزات') {
                                                $tajhizat++;
                                            } elseif ($x1->name == 'نصب') {
                                                $nasbadsl++;
                                            }

                                        }
                                    }
                                }


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $owa;
                        $send['tahvil'] = 10;
                        $send['tajhizat'] = $tajhizat;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['owa'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['owa'] = 'کاربر گرامی  هیچ فاکتور owa برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'iptv') {

                    $pursantadsl = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'iptv'])->all();

                    $iptv = 0;
                    $mande = 0;
                    $modemadsl = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $iptv++;

                                $explode = explode(',', $pa->id_added);
                                $count = count($explode);

                                for ($i = 0; $i < $count; $i++) {

                                    $x = TblAddedInformation::find()->where(['sabtnam' => 'IPTV'])->andWhere(['id' => $explode[$i]])->all();

                                    if ($x != null) {

                                        foreach ($x as $x1) {


                                            if ($x1->name == 'نصب') {
                                                $nasbadsl++;
                                            }

                                        }
                                    }
                                }


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $iptv;
                        $send['tahvil'] = 10;
                        $send['modem'] = $modemadsl;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['iptv'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['iptv'] = 'کاربر گرامی  هیچ فاکتور iptv برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }

                } 
                elseif ($_POST['type'] == 'ngn') {

                    $pursantadsl = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'ngn'])->all();

                    $ngn = 0;
                    $mande = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $ngn++;

                                if ($pa->nasb == 1) {
                                    $nasbadsl++;
                                }


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $ngn;
                        $send['tahvil'] = 10;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['ngn'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['ngn'] = 'کاربر گرامی  هیچ فاکتور ngn برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'mvno') {

                    $pursantadsl = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'mvno'])->all();

                    $mvno = 0;
                    $mande = 0;
                    $nasbadsl = 0;
                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $mvno++;

                                if ($pa->nasbdarmahal == 1) {
                                    $nasbadsl++;
                                }


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $mvno;
                        $send['tahvil'] = 10;
                        $send['nasb'] = $nasbadsl;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['mvno'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['mvno'] = 'کاربر گرامی  هیچ فاکتور mvno برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'cdn') {

                    $pursantadsl = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'cdn'])->all();

                    $cdn = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $cdn++;


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $cdn;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['cdn'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['cdn'] = 'کاربر گرامی  هیچ فاکتور cdn برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }

                } 
                elseif ($_POST['type'] == 'vas') {

                    $pursantadsl = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'vas'])->all();

                    $vas = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $vas++;


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }
                            }
                        }
                        $send['kol'] = $vas;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['vas'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['vas'] = 'کاربر گرامی  هیچ فاکتور vas برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'idc') {

                    $pursantadsl = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'idc'])->all();

                    $idc = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $idc++;


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $idc;
                        $send['tahvil'] = 9;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['idc'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['idc'] = 'کاربر گرامی  هیچ فاکتور idc برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }

                } 
                elseif ($_POST['type'] == 'vpn') {

                    $pursantadsl = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'vpn'])->all();

                    $vpn = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $vpn++;


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $vpn;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['vpn'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['vpn'] = 'کاربر گرامی  هیچ فاکتور vpn برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'x') {

                    $pursantadsl = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'x'])->all();

                    $x = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $x++;


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $x;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['x'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['x'] = 'کاربر گرامی  هیچ فاکتور پهنای باند برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'domain') {

                    $pursantadsl = Idc::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'domain'])->all();

                    $domain = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $domain++;


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $domain;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['domain'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['domain'] = 'کاربر گرامی  هیچ فاکتور domain برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'host') {

                    $pursantadsl = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'host'])->all();

                    $host = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $host++;


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $host;
                        $send['tahvil'] = 10;
                        $send['mande'] =$mande;
                        $sendlist[] = $send;
                        $sendOk['host'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['host'] = 'کاربر گرامی  هیچ فاکتور host برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                }
                elseif ($_POST['type'] == 'y') {

                    $pursantadsl = Foroshtejary::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'y'])->all();

                    $y = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $y++;


                            } else {
                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->datefa);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }
                        $send['kol'] = $y;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['y'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['y'] = 'کاربر گرامی  هیچ فاکتور فروش تجاری برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                } 
                elseif ($_POST['type'] == 'g') {

                    $pursantadsl = Ameliyateforosh::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'g'])->all();

                    $g = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $g++;


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }
                            }
                        }

                        $send['kol'] = $g;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['g'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['g'] = 'کاربر گرامی  هیچ فاکتور عاملیت فروش برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }


                }
                elseif ($_POST['type'] == 'z') {

                    $pursantadsl = Ameliyateforosh::find()->where(['id_user' => $_POST['id_user']])->andWhere(['type' => 'z'])->all();

                    $z = 0;
                    $mande = 0;

                    if ($pursantadsl != null) {

                        foreach ($pursantadsl as $pa) {

                            if ($pa->date >= $az_date && $pa->date <= $ta_date) {


                                $z++;


                            } else {

                                $explodeMonth = explode('/', $_POST['ta_tarikh']);
                                $explodeMonth2 = explode('/', $pa->date_farsi);

                                if ($explodeMonth2[1] > $explodeMonth[1]) {

                                    $mande++;
                                }


                            }
                        }

                        $send['kol'] = $z;
                        $send['tahvil'] = 10;
                        $send['mande'] = $mande;
                        $sendlist[] = $send;
                        $sendOk['z'] = $sendlist;
                        $sendOk['result'] = 1;
                        return $sendOk;

                    } else {
                        $sendOk['z'] = 'کاربر گرامی  هیچ فاکتور فروشگاه محلی برای شما ثبت نشده است.';
                        $sendOk['result'] = 0;
                        return $sendOk;
                    }

                }

//            }
//            else {
//
//            $sendOk['msg'] = 'بازه زمانی تاریخ وارد شده صحیح نمی باشد.';
//            $sendOk['result'] = 0;
//            return $sendOk;
//
//
//        }

    }
        else{
            $sendOk['msg'] = 'اطلاعات ارسالی ناقص می باشد';
            $sendOk['result'] = 0;
            return $sendOk;
        }

        }
//action done
    public function actionGozaresh_markaz(){

//        if(isset($_POST['ostan']) && $_POST['ostan']!=null
//            && isset($_POST['shahr']) && $_POST['shahr']!=null
//            && isset($_POST['markaz']) && $_POST['markaz']!=null
//        ){

//            if($_POST['ostan'] == 1){
                $ostan=TblPhone::find()->all();
                if(  $ostan!=null){

                    foreach ($ostan as $os){


                       $shahr=TblPhone::find()->where(['ostan'=>$os->ostan])->andWhere(['enable'=>'1'])
                           ->andWhere(['enableview'=>'1'])->all();
                        if( $shahr!= null){
                            foreach ($shahr as $sh){

                                $markaz=TblPhone::find()->where(['shahr'=>$sh->shahr])->andWhere(['ostan'=>$os->ostan])
                                    ->andWhere(['enable'=>'1'])->andWhere(['enableview'=>'1'])->all();
                                if( $markaz!=null){
                                    foreach ( $markaz as $m){

                                        $send['ostan']=$os->ostan;
                                        $send['shahr']=$sh->shahr;
                                        $send['markaz']=$m->name_markaz;
//                                        $send['vaziyate_forosh']=$m->vaziyat_forosh;
//                                        $send['vaziyat']=$m->vaziyat;

                                        if ($m->vaziyat_forosh == '1') {
                                           $send['vaziyate_forosh']= 'قابل فروش';


                                        }
                                        elseif ($m->vaziyat_forosh  == '0') {

                                            $send['vaziyate_forosh']= 'غیرقابل فروش';


                                        }

                                        if ($m->vaziyat == '3') {
                                              $send['vaziyat'] = 'محدود';



                                        } elseif ($m->vaziyat == '1') {
                                              $send['vaziyat'] = 'قابل پوشش';

                                        } elseif ($m->vaziyat == '2') {
                                              $send['vaziyat'] = 'غیرمحدود';


                                        } elseif ($m->vaziyat== '0') {
                                        $send['vaziyat']='  غیر قابل پوشش  ';
                                    }
                                        $sendList[]=   $send;
                                    }
                                }

                            }
                        }





                    }

                    $sendOk['vaziyat_marakez']=$sendList;
                   return $sendOk;
                }

    }
//action done
    public function actionName_marakez(){

        $name=TblPhone::find()->where(['enable'=>'1'])->andWhere(['enableview'=>'1'])->all();
        if(   $name!= null){
            $send['name_markaz']='';
            foreach (   $name as $n){

                $send['name_markaz'].=','.$n->name_markaz;

            }
            $send['result']=1;
            return $send;
        }
        else{
            $sendOk['msg']='مرکزی ثبت نشده است.';
            $sendOk['result']=0;
            return $sendOk;
        }
    }
//توی این اکشن باید ساعتی که میفرستد تا ساعت بزرگتر از از ساعت باشد
// action done
    public function actionSabtmorakhasi(){

          $model= new Morakhasi();
        if(isset($_POST['id_user']) && $_POST['id_user']!=null
        && isset($_POST['date_farsi']) && $_POST['date_farsi']!=null
        && isset($_POST['az_saat']) && $_POST['az_saat']!=null
        && isset($_POST['ta_saat']) && $_POST['ta_saat']!=null
//        && isset($_POST['sum']) && $_POST['sum']!=null
        && isset($_POST['dalil']) && $_POST['dalil']!=null
        && isset($_POST['ax_emza']) && $_POST['ax_emza']!=null
        && isset($_POST['taeed']) && $_POST['taeed']!=null
        && isset($_POST['vaziyat']) && $_POST['vaziyat']!=null
        && isset($_POST['ruzane']) && $_POST['ruzane']!=null


        ){
//return $_POST['sum'];

            $date_ir = new jdf();
            $time = explode("/", $_POST['date_farsi']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $M = $time2[1] . '-';
            $D = $time2[2];
            $g = $Y . $M . $D;






            if($_POST['ruzane']== 0){
                
                $expload=explode(':',$_POST['az_saat']);
                $expload1=explode(':',$_POST['ta_saat']);
                if($expload1[0] == '00'){
                    $expload1[0] = '24';
                }
                if($expload[0] == '00'){
                    $expload[0] = '24';
                }
                $sum0=$expload1[0]-$expload[0];
                $sum1=$expload1[1]-$expload[1];
                $sum2=$expload1[2]-$expload[2];
    $model->sum=abs($sum0).':'.abs($sum1).":".abs($sum2);
}else{
             $x=$_POST['ruzane']*24;
                $model->sum=$x.':00:00';
}


            $model->date = date($g);
            $model->id_user=$_POST['id_user'];
            $model->date_farsi=$_POST['date_farsi'];
            $model->az_saat=$_POST['az_saat'];
            $model->ta_saat=$_POST['ta_saat'];

            $model->dalil=$_POST['dalil'];
            $model->ax_emza=$_POST['ax_emza'];
            $model->taeed=$_POST['taeed'];
            $model->vaziyat=$_POST['vaziyat'];
            $model->ruzane=$_POST['ruzane'];



           if( $model->save()){
               $sendOk['msg']='اطلاعات ذخیره شد.';
               $sendOk['result']=1;
               return   $sendOk;
            }else{
//               var_dump($model->getErrors());exit;
               $sendOk['msg']='اطلاعات ذخیره نشد.';
               $sendOk['result']=0;
               return  $sendOk;
           }




        }
        $sendOk['msg']='اطلاعات ارسالی ناقص می باشد';
        $sendOk['result']=0;
        return  $sendOk;

}
// action done
    public function actionGozaremorakhasi(){


        if(isset($_POST['id_user']) && $_POST['id_user']
         && isset($_POST['az_tarikh']) && $_POST['az_tarikh']
         && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh']
        ){
            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);
//            if($_POST['az_tarikh'] <= $_POST['ta_tarikh']){


                $search=Morakhasi::find()->where(['id_user'=>$_POST['id_user']])->all();

                if($search!= null){

                    foreach ($search as $s){

                        if($s->ruzane ==0){


                            if($s->date >= $az_date && $s->date <= $ta_date){

                                $send['date']= $s->date_farsi;
                                $send['mizane_morakhasi']= $s->sum;
                                if($s->taeed == 0){
                                    $send['vaziyat']= 'در حال بررسی';
                                }elseif ($s->taeed == 1){
                                    $send['vaziyat']= 'تایید';
                                }else{
                                    $send['vaziyat']= $s->vaziyat.'عدم تایید';
                                }

                                $sendList[]= $send;


                            }
                        }

                    }

                    $sendOk['gozaresh_morakhasi']= $sendList;
                    return    $sendOk;


                }else{

                    $sendOk['msg']='هیچ درخواست مرخصی در این تاریخ ثبت نشده است.';
                    $sendOk['result']=0;
                    return  $sendOk;
                }


//            }
//            else{
//
//                $sendOk['msg'] = 'بازه زمانی تاریخ وارد شده صحیح نمی باشد.';
//                $sendOk['result'] = 0;
//                return $sendOk;
//

//            }


        }

    }

    // action done
    public function actionGozaremorakhasi_ruzane(){


        if(isset($_POST['id_user']) && $_POST['id_user']
            && isset($_POST['az_tarikh']) && $_POST['az_tarikh']
            && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh']
        ){
            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);
//            if($_POST['az_tarikh'] <= $_POST['ta_tarikh']){


            $search=Morakhasi::find()->where(['id_user'=>$_POST['id_user']])->all();

            if($search!= null){

                foreach ($search as $s){

                    if($s->ruzane !=0){


                        if($s->date >= $az_date && $s->date <= $ta_date){

                            $send['date']= $s->date_farsi;
                            $send['mizane_morakhasi']= $s->sum;
                            if($s->taeed == 0){
                                $send['vaziyat']= 'در حال بررسی';
                            }elseif ($s->taeed == 1){
                                $send['vaziyat']= 'تایید';
                            }else{
                                $send['vaziyat']= $s->vaziyat.'عدم تایید';
                            }

                            $sendList[]= $send;


                        }
                    }

                }

                $sendOk['gozaresh_morakhasi']= $sendList;
                return    $sendOk;


            }else{

                $sendOk['msg']='هیچ درخواست مرخصی در این تاریخ ثبت نشده است.';
                $sendOk['result']=0;
                return  $sendOk;
            }


//            }
//            else{
//
//                $sendOk['msg'] = 'بازه زمانی تاریخ وارد شده صحیح نمی باشد.';
//                $sendOk['result'] = 0;
//                return $sendOk;
//

//            }


        }

    }
//action down
    public function actionPishnehadat_enteqadat1(){

        $model= new Pishnehadenteqad();
        if(isset($_POST['id_user']) && $_POST['id_user']!=null
        && isset($_POST['type_darkhast']) && $_POST['type_darkhast']!=null
        && isset($_POST['vahede_marbute']) && $_POST['vahede_marbute']!=null
        && isset($_POST['title']) && $_POST['title']!=null
        && isset($_POST['date_farsi']) && $_POST['date_farsi']!=null
        && isset($_POST['text']) && $_POST['text']!=null
        && isset($_POST['result']) && $_POST['result']!=null
        && isset($_POST['time_result_farsi']) && $_POST['time_result_farsi']!=null
      
        ){


            $date_ir = new jdf();
            $time = explode("/", $_POST['date_farsi']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $M = $time2[1] . '-';
            $D = $time2[2];
            $g = $Y . $M . $D;


//            $date_ir1 = new jdf();
//            $time1 = explode("/", $_POST['time_result_farsi']);
//            $d1 = $time1[0];
//            $m1 = $time1[1];
//            $y1 = $time1[2];
//            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);
//
//            $Y1 = $time21[0] . '-';
//            $M1 = $time21[1] . '-';
//            $D1 = $time21[2];
//            $g1 = $Y1 . $M1 . $D1;

            $model->time_result = $_POST['time_result_farsi'];
            $model->date = date($g);
            $model->id_user = $_POST['id_user'];
            $model->type_darkhast= $_POST['type_darkhast'];
            $model->vahede_marbute= $_POST['vahede_marbute'];
            $model->title= $_POST['title'];
            $model->date_farsi= $_POST['date_farsi'];
            $model->text= $_POST['text'];
            $model->result= $_POST['result'];
            $model->time_result_farsi=$_POST['time_result_farsi'] ;
            $model->id_parent= 0;

            if($model->save()){

                $sendOk['msg']='عملیات با موفقیت انجام شد.';
                $sendOk['result']='1';
                return  $sendOk;
            }
            else{
//                var_dump($model->getErrors());exit;
                $sendOk['msg']='عملیات  انجام نشد.';
                $sendOk['result']='0';
                return  $sendOk;
            }


        }else{

            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد';
            $sendOk['result']= 0;
            return  $sendOk;
        }

    }

    public function actionPishnehadat_enteqadat2(){

        $model= new Pishnehadenteqad();

        if(isset($_POST['id_user']) && $_POST['id_user']!=null) {


            if (isset($_POST['type_darkhast']) && $_POST['type_darkhast'] != null
                && isset($_POST['vahede_marbute']) && $_POST['vahede_marbute'] != null
                && isset($_POST['title']) && $_POST['title'] != null
                && isset($_POST['date_farsi']) && $_POST['date_farsi'] != null
                && isset($_POST['text']) && $_POST['text'] != null
                && isset($_POST['result']) && $_POST['result'] != null
                && isset($_POST['time_result_farsi']) && $_POST['time_result_farsi'] != null
                && isset($_POST['id_user_pasokh']) && $_POST['id_user_pasokh'] != null

            ) {


                $date_ir = new jdf();
                $time = explode("/", $_POST['date_farsi']);
                $d = $time[0];
                $m = $time[1];
                $y = $time[2];
                $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

                $Y = $time2[0] . '-';
                $M = $time2[1] . '-';
                $D = $time2[2];
                $g = $Y . $M . $D;


//            $date_ir1 = new jdf();
//            $time1 = explode("/", $_POST['time_result_farsi']);
//            $d1 = $time1[0];
//            $m1 = $time1[1];
//            $y1 = $time1[2];
//            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);
//
//            $Y1 = $time21[0] . '-';
//            $M1 = $time21[1] . '-';
//            $D1 = $time21[2];
//            $g1 = $Y1 . $M1 . $D1;

                $model->time_result = $_POST['time_result_farsi'];
                $model->date = date($g);
                $model->id_user = $_POST['id_user'];
                $model->type_darkhast = $_POST['type_darkhast'];
                $model->vahede_marbute = $_POST['vahede_marbute'];
                $model->title = $_POST['title'];
                $model->date_farsi = $_POST['date_farsi'];
                $model->text = $_POST['text'];
                $model->result = $_POST['result'];
                $model->time_result_farsi = $_POST['time_result_farsi'];
                $model->id_parent = $_POST['id_user_pasokh'];

                if ($model->save()) {

                    $sendOk['msg'] = 'عملیات با موفقیت انجام شد.';
                    $sendOk['result'] = '1';
                    return $sendOk;
                } else {
                    $chek = Pishnehadenteqad::find()->where(['id_user' => $_POST['id_user']])->all();
//                var_dump($model->getErrors());exit;
                    $sendOk['msg'] = 'عملیات  انجام نشد.';
                    $sendOk['result'] = '0';
                    return $sendOk;
                }


            } else {




            $search = Pishnehadenteqad::find()->where(['id_user'=>$_POST['id_user']])->all();
            if ($search != null) {
                foreach ($search as $s) {

                    $chek=Pishnehadenteqad::find()->where(['id_user'=>$_POST['id_user']])->andWhere(['id'=>$s->id_parent])->count();
                    if($chek == 1){
                  

                    }
                    elseif($chek == 0) {

                    $send['id'] = $s->id;
                    $send['time_darkhast'] = $s->date_farsi;
                    $send['type_darkhast'] = $s->type_darkhast;
                    $send['vahede_marbute'] = $s->vahede_marbute;
                    $send['title'] = $s->title;
                    $send['time_result'] = $s->time_result_farsi;
                    $send['result'] = $s->result;
                    $senddList1[] = $send;



                            $item = Pishnehadenteqad::find()->where(['id_parent' => $s->id])->andWhere(['id_user' => $_POST['id_user']])->one();

                        if ($item != null) {
                            $send['id'] = $item->id;
                            $send['time_darkhast'] = $s->date_farsi;
                            $send['type_darkhast'] = $s->type_darkhast;
                            $send['vahede_marbute'] = $s->vahede_marbute;
                            $send['title'] = $s->title;
                            $send['time_result'] = $item->time_result_farsi;
                            $send['result'] = $item->result;
                            $senddList[] = $send;
                        } else {
                            $send['id'] = -1;
                            $send['time_darkhast'] = $s->date_farsi;
                            $send['type_darkhast'] = $s->type_darkhast;
                            $send['vahede_marbute'] = $s->vahede_marbute;
                            $send['title'] = $s->title;
                            $send['time_result'] = '__';
                            $send['result'] = 'درحال بررسی';
                            $senddList[] = $send;
                        }
                    }
                }
                $sendOk['p_e'] = $senddList1;
                $sendOk['moshahede'] = $senddList;
                $sendOk['result'] = 1;
                return $sendOk;
            }
            $sendOk['moshahede'] = 'هیچ انتفاد یا پیشنهادی ثبت نشده است.';
            $sendOk['result'] = 0;
            return $sendOk;
             }
        }
        else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result'] = 0;
            return $sendOk;
        }

    }

    public function actionMosaeede(){

        $model= new Mosaede();

        if(isset($_POST['id_user']) && $_POST['id_user']){

            $mosaede=Mosaede::find()->where(['id_user'=>$_POST['id_user']])->all();
            if($mosaede!=null){

                foreach ($mosaede as $ms){
                    $send['date']=$ms->date_farsi;
                    $send['darkhast']=$ms->darkhast;
                    if($ms->vaziyat == 0){

                        $send['vaziyat']='درحال بررسی';
                    }elseif ($ms->vaziyat == 1){

                        $send['vaziyat'] ='پرداخت شد.';

                    }elseif ($ms->vaziyat == 1){

                        $send['vaziyat'] ='عدم تایید'.$ms->dalil;

                    }
                    $sendFull[]=$send;
                }

                $sendOk['darkhast_pishin']=$sendFull;
//                return $sendOk;
            }else{   $sendOk['darkhast_pishin']='شما تا به حال درخواستی نداشته اید';   }


            if(  isset($_POST['darkhast']) && $_POST['darkhast']
                && isset($_POST['date_farsi']) && $_POST['date_farsi']

            ){


                $date_ir = new jdf();
                $time = explode("/", $_POST['date_farsi']);
                $d = $time[0];
                $m = $time[1];
                $y = $time[2];
                $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

                $Y = $time2[0] . '-';
                $M = $time2[1] . '-';
                $D = $time2[2];
                $g = $Y . $M . $D;

                $model->date=$g;
                $model->id_user=$_POST['id_user'];
                $model->darkhast=$_POST['darkhast'];
                $model->date_farsi=$_POST['date_farsi'];
                $model->vaziyat=0;
                $model->dalil='0';
                if($model->save()){
                    $sendOk['msg']='عملیات با موفقیت انجام شد.';
                    $sendOk['result']=1;
                    return $sendOk;
                }
                else{
                    $sendOk['msg']='عملیات با موفقیت انجام نشد.';
                    $sendOk['result']=0;
                    return $sendOk;
                }


            }
            else{


                $sendOk['result']=1;
                return  $sendOk;

            }

        }
        else{


            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد';
            $sendOk['result']=0;
            return $sendOk;

        }


    }

    public function actionKartabl_karshenas_nasb(){

        if(isset($_POST['type']) && $_POST['type']!=null
            && isset($_POST['id_user']) && $_POST['id_user']!=null){

            $search=Tbltarget::find()->where(['id_user'=>$_POST['id_user']])->andWhere(['type_eshterak'=>$_POST['type']])->all();
            if($search!=null){

                foreach ($search as $item){
                    $send['eshterak']=$item->eshterak;
                    $send['tarikh_morajee']=$item->tarikh_morajee;
                    $send['saat_morajee']=$item->saat_morajee;
                    $send['file']='file';
                    $sendList[]=$send;
                }
                $sendOk['kkn']= $sendList;
                $sendOk['result']=1;
                return $sendOk;
            }
            else{
                $sendOk['msg']='موجود نیست';
                $sendOk['result']=0;
                return $sendOk;
            }

        }
        else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }

    }

    public function actionKartabl_man()
    {

        if (isset($_POST['semat']) && $_POST['semat'] != null
            && isset($_POST['id_user']) && $_POST['id_user'] != null
        ) {

            $find=Profile::find()->where(['id_user'=> $_POST['id_user']])->one();
            if($find->semat == $_POST['semat']){


                if ($_POST['semat'] == 1 || $_POST['semat'] == 2) {

                    $search = Tbltarget::find()->where(['id_user' => $_POST['id_user']])->all();
                    $adsl = 0;
                    $vdsl = 0;
                    $owa = 0;
                    $td = 0;
                    $ngn = 0;
                    $iptv = 0;

                    if ($search != null) {
                        foreach ($search as $item) {

                            if ($item->type_eshterak == 'adsl') {
                                $adsl++;
                            } elseif ($item->type_eshterak == 'vdsl') {
                                $vdsl++;
                            } elseif ($item->type_eshterak == 'td-lte') {
                                $td++;
                            } elseif ($item->type_eshterak == 'owa') {
                                $owa++;
                            } elseif ($item->type_eshterak == 'ngn') {
                                $ngn++;
                            } elseif ($item->type_eshterak == 'iptv') {
                                $iptv++;
                            }


                        }

                        $send['adsl'] = $adsl;
                        $send['vdsl'] = $vdsl;
                        $send['td-lte'] = $td;
                        $send['owa'] = $owa;
                        $send['ngn'] = $ngn;
                        $send['iptv'] = $iptv;
                        $send['result']=1;
                        $sendlist=$send;
                        return $sendlist;
                    } else {
                        $send['adsl'] = $adsl;
                        $send['vdsl'] = $vdsl;
                        $send['td-lte'] = $td;
                        $send['owa'] = $owa;
                        $send['ngn'] = $ngn;
                        $send['iptv'] = $iptv;
                        $send['result']=1;
                        $sendlist=$send;
                        return $sendlist;
                    }
                }
                else{
                    $sendOk['msg']='دسترسی به این اطلاعات برای شما مجاز نمی باشد';
                    $sendOk['result']=0;
                    return $sendOk;
                }

            }
            else{
                $sendOk['msg']='سمت وارد شده متعلق به شما نمی باشد.';
                $sendOk['result']=0;
                return $sendOk;
            }



        }
        else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }

    }

    public function actionKarshenas_nasb_mablaq(){


        if(isset($_POST['id_user']) && $_POST['id_user']
            && isset($_POST['eshterak']) && $_POST['eshterak']
            && isset($_POST['type']) && $_POST['type']) {


            if ($_POST['type'] == 'adsl' || $_POST['type'] == 'vdsl' || $_POST['type'] == 'td-lte') {

                $search = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['eshterak' => $_POST['eshterak']])
                    ->andWhere(['type' => $_POST['type']])->one();
                $modem = 0;
                $type_modem = 'void';
                if ($search != null) {
                    $expload = explode(',', $search->id_added);
                    $count = count($expload);
                    for ($i = 0; $i < $count; $i++) {

                        $search_modem = TblAddedInformation::find()->where(['id' => $expload[$i]])->one();


                        if ($search_modem != null) {

                            if ($search_modem->name == 'مودم') {

                                $modem++;
                                if ($search_modem->service != 'void') {

                                    $type_modem = $search_modem->service;
                                }
                            }
                        }


                    }
                    $sendOk['modem'] = $modem;
                    $sendOk['type_modem'] = $type_modem;
                    $sendOk['price'] = $search->price;
                    $sendOk['price_nahaii'] = $search->price;
                    $sendOk['dalil_ekhtelaf_qeymat'] = 'dsfsgs';
                    $sendOk['result'] = 1;
                    return $sendOk;


                } else {
                    $sendOk['msg'] = 'اطلاعاتی موجود نیست.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }

            } elseif ($_POST['type'] == 'iptv') {

                $search = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['eshterak' => $_POST['eshterak']])
                    ->andWhere(['type' => $_POST['type']])->one();
                $sbt = 0;

                if ($search != null) {


                    $search_sbt = TblServices1::find()->where(['id' => $search->id_services])->one();


                    if ($search_sbt != null) {


                        $sbt++;

                    }


                    $sendOk['sbt'] = $sbt;
                    $sendOk['name'] = $search_sbt->name;
                    $sendOk['price'] = $search->price;
                    $sendOk['price_nahaii'] = $search->price;
                    $sendOk['dalil_ekhtelaf_qeymat'] = 'dsfsgs';
                    $sendOk['result'] = 1;
                    return $sendOk;


                } else {
                    $sendOk['msg'] = 'اطلاعاتی موجود نیست.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }
            } elseif ($_POST['type'] == 'owa') {

                $search = Adsl::find()->where(['id_user' => $_POST['id_user']])->andWhere(['eshterak' => $_POST['eshterak']])
                    ->andWhere(['type' => $_POST['type']])->one();
                $tajhizat = 0;

                if ($search != null) {
                    $expload = explode(',', $search->id_added);
                    $count = count($expload);
                    for ($i = 0; $i < $count; $i++) {

                        $search_modem = TblAddedInformation::find()->where(['id' => $expload[$i]])->one();


                        if ($search_modem != null) {

                            if ($search_modem->name == 'تجهیزات') {

                                $tajhizat++;

                            }
                        }


                    }
                    $sendOk['tajhizat'] = $tajhizat;
                    $sendOk['price'] = $search->price;
                    $sendOk['price_nahaii'] = $search->price;
                    $sendOk['dalil_ekhtelaf_qeymat'] = 'dsfsgs';
                    $sendOk['result'] = 1;
                    return $sendOk;


                } else {
                    $sendOk['msg'] = 'اطلاعاتی موجود نیست.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }
            } elseif ($_POST['type'] == 'ngn') {

                $search = FactorNgn::find()->where(['id_user' => $_POST['id_user']])->andWhere(['eshterak' => $_POST['eshterak']])
                    ->andWhere(['type' => $_POST['type']])->one();


                if ($search != null) {


                    $sendOk['sip'] = $search->tedad_sip;
                    $sendOk['price'] = $search->price;
                    $sendOk['price_nahaii'] = $search->price;
                    $sendOk['dalil_ekhtelaf_qeymat'] = 'dsfsgs';
                    $sendOk['result'] = 1;
                    return $sendOk;


                } else {
                    $sendOk['msg'] = 'اطلاعاتی موجود نیست.';
                    $sendOk['result'] = 0;
                    return $sendOk;
                }


            }
        }else{

            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }

    }

    public function actionKarshenas_nasb_ersal(){

       $model= new Karshenasnasb();

        if(isset($_POST['id_user']) && $_POST['id_user']
            && isset($_POST['molahezat']) && $_POST['molahezat']
            && isset($_POST['nahve_pardakht']) && $_POST['nahve_pardakht']
            && isset($_POST['name_wifi']) && $_POST['name_wifi']
            && isset($_POST['password']) && $_POST['password']
            && isset($_POST['eshterak']) && $_POST['eshterak']
            && isset($_POST['type']) && $_POST['type']
            && isset($_POST['type_qarardad']) && $_POST['type_qarardad']
            && isset($_POST['dalil']) && $_POST['dalil']
            && isset($_POST['ax_emza']) && $_POST['ax_emza']
            && isset($_POST['vaziyat_nasb']) && $_POST['vaziyat_nasb']
            && isset($_POST['be_tarikh']) && $_POST['be_tarikh']
            && isset($_POST['be_saat']) && $_POST['be_saat']
            && isset($_POST['tozihat']) && $_POST['tozihat']
            && isset($_POST['ax1']) && $_POST['ax1']
            && isset($_POST['ax2']) && $_POST['ax2']
            && isset($_POST['ax3']) && $_POST['ax3']
            && isset($_POST['ax4']) && $_POST['ax4']
        ){


            $model->id_user = $_POST['id_user'];
            $model->molahezat = $_POST['molahezat'];
            $model->nahve_pardakht = $_POST['nahve_pardakht'];
            $model->name_wifi = $_POST['name_wifi'];
            $model->password = $_POST['password'];
            $model->eshterak = $_POST['eshterak'];
            $model->sabtnam = $_POST['type'];
            $model->type_qarardad = $_POST['type_qarardad'];
            $model->dalil = $_POST['dalil'];
            $model->ax_emza = $_POST['ax_emza'];
            $model->vaziyat_nasb = $_POST['vaziyat_nasb'];
            $model->be_tarikh = $_POST['be_tarikh'];
            $model->b_saat = $_POST['be_saat'];
            $model->tozihat = $_POST['tozihat'];
            $model->ax1 = $_POST['ax1'];
            $model->ax2 = $_POST['ax2'];
            $model->ax3 = $_POST['ax3'];
            $model->ax4 = $_POST['ax4'];


            if($model->save()){

                $sendOk['msg']='عملیات با موفقیت انجام شد.';
                $sendOk['result']=1;
                return $sendOk;
            }
            else{
//                var_dump($model->getErrors());exit;
                $sendOk['msg']='عملیات با موفقیت انجام نشد.';
                $sendOk['result']=0;
                return $sendOk;
            }

        }
        else{

            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }


    }


    //این اکشن نوشته شده است فقط مانده اینکه وضعیت چه چیزی را قرار است ارسال کند.
    public function actionGozaresh_kartabl(){

        if(isset($_POST['id_user']) && $_POST['id_user']
            && isset($_POST['type']) && $_POST['type']
            && isset($_POST['az_tarikh']) && $_POST['az_tarikh']
            && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh']
        ){
            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);

            if($_POST['type'] == 'adsl'
            || $_POST['type'] == 'vdsl'
            || $_POST['type'] == 'owa'
            || $_POST['type'] == 'td-lte'
            || $_POST['type'] == 'iptv'
            ){

                $search=Adsl::find()->where(['type'=>$_POST['type'] ])
                    ->andWhere(['id_user'=>$_POST['id_user']])->all();
                if($search!= null){

                    foreach ($search as $item){

                        if( $item->date >= $az_date && $item->date <= $ta_date){



                        }
                    }


                }
                else{
                    $sendOk['msg']='اطلاعات موجود نیست.';
                    $sendOk['result']=0;
                    return $sendOk;
                }
            }



        }
        else{
            $sendOk['msg']='اطلاعات ارسالی ناقص می باشد.';
            $sendOk['result']=0;
            return $sendOk;
        }

    }
    

    public function actionSavepres(){
        if (isset($_POST['check']) && $_POST['check'] != null
            && isset($_POST['lat']) && $_POST['lat']!=null
            && isset($_POST['lng']) && $_POST['lng']!=null
            && isset($_POST['id_user']) && $_POST['id_user']!=null
        ) {

            $check=$_POST['check'];
            $adress = $_POST['adress'];
            $lat=floatval($_POST['lat']);
            $lng = floatval($_POST['lng']);
            $tbl = new TblPresence();
//            $tbl->id_user = Yii::$app->user->id;
            $tbl->id_user = $_POST['id_user'];
            date_default_timezone_set("Asia/Tehran");
            $data = new jdf();
            $tbl->dateIr = $data->date('y/m/d');
            $tbl->date=date('Y/m/d');
            $tbl->timeStamp = date("Y/m/d H:i:s");
            $gen=new \common\components\General();
            $tbl->time=$gen->timeMake(date("Y/m/d H:i:s"));
            if($check == "1"){
                $tbl->login = 1;
                $tbl->logout=0 ;
            }else if($check == "0"){
                $tbl->login = 0;
                $tbl->logout= 1 ;
            }
            $tbl->enabel = 1;
            $tbl->enabel_view = 1 ;
            $tbl->adress=$adress;
            $tbl->lng=$lng;
            $tbl->lat=$lat;
            $tbl->sh1 = "is null";
            $tbl->sh2 = "is null";
            $tbl->sh3 = "is null";
            $tbl->sh4 = "is null";
            if($tbl->save()){
                print "1";
                exit;
            }else{
                print "در ذخیره اطلاعات مشکلی وجود دارد";
                exit;
            }

        }
        print "در ارسال اطلاعات به سرور مشکلی وجود دارد";
        exit;
    }

    public function actionGetpolyline(){

        if($_POST['id_user']!= null && isset($_POST['id_user'])){

            //        $user = Yii::$app->user->id;

            $pro=new Profile();
//        echo yii::$app->user->id;
//        exit;
            $pro1=$pro->findOne(["id_user"=>$_POST['id_user']]);
            if($pro1!= null){



                $model = new Tblcoordinates();
                $model2=$model->find()->where(["id_range"=>$pro1->id_mantaqe])->all();
                if($model2!= null){
                    foreach ($model2 as $row){
                        $res["lat"] =$row->lat;
                        $res["lng"] = $row->lng;
                        $result[]=$res;
                    }
                    $send['mahdude']= $result;
                    $send['result']= 1;
                }else{
                    $send['result']=0;
                    $send['msg']='متاسفانه منطقه مورد نظر یافت نشد';
                    return $send;
                }



            }else{
                $send['result']=0;
                $send['msg']='کاربر موجود نیست';
                return $send;
            }
        }else{

             $send['result']=0;
             $send['msg']='تمامی اطلاعات درست ارسال نشده است';
            return $send;
        }


        return $send;
    }


    public function actionGozareshsaatkary(){

        if($_POST['id_user']!= null && isset($_POST['id_user'])
            && $_POST['az_tarikh']!= null && isset($_POST['az_tarikh'])
            && $_POST['ta_tarikh']!= null && isset($_POST['ta_tarikh'])
        ){
            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
        if(  $ML == 1){
            $M = 0 . $time2[1] . '-';

        }else{
            $M =$time2[1] . '-';
        }
         if($DL == 1 ){
             $D = 0 . $time2[2];
         }  else{
             $D = $time2[2];
         }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);


            $search=TblPresence::find()->where(['id_user'=>$_POST['id_user']])
                ->andWhere(['enabel'=>1])->andWhere(['enabel_view'=>1])->all();

            if( $search!=null){
                $sum='00:00:00';

                foreach ($search as $item){


                    if($item->date >= $az_date && $item->date <=  $ta_date){

                        $login=$search[0]->time;

                        if($item->login == 1){

                        }
                        else{

                            $logout=$item->time;

                             $diff = $logout - $login;
                             $time= gmdate("H:i:s",  $diff);

                            $send['time']=   $time;

                            $ee=explode(':',$time);
                            $eee=explode(':',$sum);
                            $sum=( $eee[0] + $ee[0]) .':'. ($eee[1] + $ee[1] ) .':'.($eee[2] + $ee[2]) ;

                                $timelogin= gmdate("H:i:s",  $login);
                                $send['login']= $timelogin;

                                $timelogout= gmdate("H:i:s", $logout );
                                $send['logout']= $timelogout;
                                $send['tarikh']=$item->dateIr;
                                 $sendList[]= $send;

                        }

                    }

                }

                $sendOk['jametime']= $sum;
                $sendOk['sd']=$sendList;


                $user=Profile::find()->where(['id_user'=>$_POST['id_user']])->one();

                $ee1=explode(':',$user->saatkari_az);
                $eee1=explode(':',$user->saatkari_ta);
                $x=( $eee1[0] - $ee1[0]) .':'. ($eee1[1] - $ee1[1] );

                $ee2=explode(':',$x);
                $eee2=explode(':',$sum);
                $y=( $eee2[0] - $ee2[0]) .':'. ($eee2[1] - $ee2[1] );
                if($y>0){
                    $sendOk['enheraf']='+'.$y;
                }else{
                    $y=abs(( $eee2[0] - $ee2[0])) .':'. abs(($eee2[1] - $ee2[1] ));
                    $sendOk['enheraf']='-'.$y;
                }

                return   $sendOk;

            }



        }
        else{

            $sendOk['msg']='اطلاات ارسالی ناقص می باشد';
            $sendOk['result']=0;
//            return $sendOk;
        }

    }


    public function actionDaryaft_pursant(){


        if(isset($_POST['id_user']) && $_POST['id_user']
        && isset($_POST['az_tarikh']) && $_POST['az_tarikh']
        && isset($_POST['ta_tarikh']) && $_POST['ta_tarikh']
        ){

            $date_ir = new jdf();
            $time = explode("/", $_POST['az_tarikh']);
            $d = $time[0];
            $m = $time[1];
            $y = $time[2];
            $time2 = $date_ir->jalaliToGregorian($y, $m, $d);

            $Y = $time2[0] . '-';
            $ML =strlen( $time2[1]) ;
            $DL= strlen( $time2[2]);
            if(  $ML == 1){
                $M = 0 . $time2[1] . '-';

            }else{
                $M =$time2[1] . '-';
            }
            if($DL == 1 ){
                $D = 0 . $time2[2];
            }  else{
                $D = $time2[2];
            }



            $g = $Y . $M . $D;

            $az_date = date($g);

            $date_ir1 = new jdf();
            $time1 = explode("/", $_POST['ta_tarikh']);
            $d1 = $time1[0];
            $m1 = $time1[1];
            $y1 = $time1[2];
            $time21 = $date_ir1->jalaliToGregorian($y1, $m1, $d1);

            $Y1 = $time21[0] . '-';
            $ML1 =strlen( $time21[1]) ;
            $DL1= strlen( $time21[2]);
            if(  $ML1 == 1){
                $M1 = 0 . $time21[1] . '-';

            }else{
                $M1 =$time21[1] . '-';
            }
            if($DL1 == 1 ){
                $D1 = 0 . $time21[2];
            }  else{
                $D1 = $time21[2];
            }

            $g1 = $Y1 . $M1 . $D1;

            $ta_date = date($g1);

            $send['pursant']=0;
            $send['nasb']=0;
            $send['modem'] =0;
            $send['ip_service'] =0;

            $send1['pursant']=0;
            $send1['nasb']=0;
            $send1['modem'] =0;
            $send1['ip_service'] =0;

            $send2['pursant']=0;
            $send2['nasb']=0;
            $send2['modem'] =0;
            $send2['ip_service'] =0;

            $send3['pursant']=0;
            $send3['nasb']=0;
            $send3['ip'] =0;

            $send4['pursant']=0;
            $send4['nasb']=0;
            $send4['SIP-PHONE']=0;
            $send4['SOFT-PHONE']=0;

            $send5['pursant']=0;
            $send5['nasb']=0;

            $send6['pursant']=0;
            $send6['nasb']=0;



            $searchadsl=Adsl::find()->where(['id_user'=>$_POST['id_user']])->all();

            if( $searchadsl!=null) {

                foreach ($searchadsl as $itemadsl) {

                    if ($itemadsl->date >= $az_date && $itemadsl->date <= $ta_date) {

                        if ($itemadsl->type == 'adsl') {

                            $exid = explode(',', $itemadsl->id_added);
                            $contid = count($exid);


                            $sabtnam = Sabtnam::find()->where(['name' => 'ADSL'])->one();
                            $send['pursant'] += $sabtnam->porsant;

                            for ($i = 0; $i < $contid; $i++) {

                                $id_adedd = TblAddedInformation::find()->where(['sabtnam' => 'ADSL'])->andWhere(['id' => $exid[$i]])->one();

                                if ($id_adedd != null) {

                                    if ($id_adedd->name == 'نصب') {


                                        $send['nasb'] += $id_adedd->pursant;

                                    } elseif ($id_adedd->name == 'مودم') {

                                        $send['modem'] += $id_adedd->pursant;

                                    } else {

                                        $send['ip_service'] += $id_adedd->pursant;
                                    }

                                }

                            }
                        }
                        elseif ($itemadsl->type == 'vdsl'){

                            $exid=explode(',',$itemadsl->id_added);
                            $contid=count( $exid);



                            $sabtnam=Sabtnam::find()->where(['name'=>'VDSL'])->one();
                            $send1['pursant']+= $sabtnam->porsant;

                            for($i=0; $i<$contid;$i++){

                                $id_adedd=TblAddedInformation::find()->where(['sabtnam'=>'VDSL'])->andWhere(['id'=>$exid[$i]])->one();

                                if($id_adedd!=null){

                                    if($id_adedd->name == 'نصب' ){


                                        $send1['nasb']+=$id_adedd->pursant;

                                    }elseif ($id_adedd->name == 'مودم'){

                                        $send1['modem']+=$id_adedd->pursant;

                                    }else{

                                        $send1['ip_service']+=$id_adedd->pursant;
                                    }

                                }

                            }
                        }
                        elseif ($itemadsl->type == 'td-lte'){

                            $exid=explode(',',$itemadsl->id_added);
                            $contid=count( $exid);



                            $sabtnam=Sabtnam::find()->where(['name'=>'TD-LTE'])->one();
                            $send2['pursant']+= $sabtnam->porsant;

                            for($i=0; $i<$contid;$i++){

                                $id_adedd=TblAddedInformation::find()->where(['sabtnam'=>'TD-LTE'])->andWhere(['id'=>$exid[$i]])->one();

                                if($id_adedd!=null){

                                    if($id_adedd->name == 'نصب' ){


                                        $send2['nasb']+=$id_adedd->pursant;

                                    }elseif ($id_adedd->name == 'مودم'){

                                        $send2['modem']+=$id_adedd->pursant;

                                    }else{

                                        $send2['ip_service']+=$id_adedd->pursant;
                                    }

                                }

                            }
                        }
                        elseif ($itemadsl->type == 'owa'){

                            $exid=explode(',',$itemadsl->id_added);
                            $contid=count( $exid);



                            $sabtnam=Sabtnam::find()->where(['name'=>'OWA'])->one();
                            $send3['pursant']+= $sabtnam->porsant;

                            for($i=0; $i<$contid;$i++){

                                $id_adedd=TblAddedInformation::find()->where(['sabtnam'=>'OWA'])->andWhere(['id'=>$exid[$i]])->one();

                                if($id_adedd!=null){

                                    if($id_adedd->name == 'نصب' ){


                                        $send3['nasb']+=$id_adedd->pursant;

                                    }else{

                                        $send3['ip']+=$id_adedd->pursant;
                                    }

                                }

                            }
                        }
                        elseif ($itemadsl->type == 'iptv'){

                            $exid=explode(',',$itemadsl->id_added);
                            $contid=count( $exid);



                            $sabtnam=Sabtnam::find()->where(['name'=>'IPTV'])->one();
                            $send6['pursant']+= $sabtnam->porsant;

                            for($i=0; $i<$contid;$i++){

                                $id_adedd=TblAddedInformation::find()->where(['sabtnam'=>'IPTV'])->andWhere(['id'=>$exid[$i]])->one();

                                if($id_adedd!=null){

                                    if($id_adedd->name == 'نصب' ){


                                        $send6['nasb'] +=$id_adedd->pursant;

                                    }

                                }

                            }
                        }

                    }

                }
                $sendOk['adsl']= $send;
                $sendOk['vdsl']= $send1;
                $sendOk['td-lte']= $send2;
                $sendOk['owa']= $send3;
                $sendOk['iptv']= $send6;


            }
            else{
                $sendOk['adsl']= $send;
                $sendOk['vdsl']= $send1;
                $sendOk['td-lte']= $send2;
                $sendOk['owa']= $send3;
                $sendOk['iptv']= $send6;
            }


            $searchadsl=FactorNgn::find()->where(['id_user'=>$_POST['id_user']])->all();
            if( $searchadsl!=null){

                foreach ($searchadsl as $itemadsl){

                    if($itemadsl->date >= $az_date && $itemadsl->date <=  $ta_date){

                        if($itemadsl->type == 'ngn' ){

                            $sabtnam=Sabtnam::find()->where(['name'=>'NGN'])->one();
                            $send4['pursant']+= $sabtnam->porsant;


                            if($itemadsl->nasb == 1){
                                $nasb=TblAddedInformation::find()->where(['sabtnam'=>'NGN'])->andWhere(['name'=>'نصب'])->one();
                                if(  $nasb!=null){
                                    $send4['nasb'] +=$nasb->pursant;
                                }
                            }
                            if($itemadsl->tedad_sip != 0){
                                $nasb=TblAddedInformation::find()->where(['sabtnam'=>'NGN'])->andWhere(['name'=>'SIP-PHONE'])->one();
                                if(  $nasb!=null){
                                    $send4['SIP-PHONE']+=$nasb->pursant;
                                }

                            }
                            if($itemadsl->tedad_soft != 0){
                                $nasb=TblAddedInformation::find()->where(['sabtnam'=>'NGN'])->andWhere(['name'=>'SOFT-PHONE'])->one();
                                if(  $nasb!=null){
                                    $send4['SOFT-PHONE']+=$nasb->pursant;
                                }

                            }

                        }

                        if($itemadsl->type == 'mvno' ){

                            $sabtnam=Sabtnam::find()->where(['name'=>'MVNO'])->one();
                            $send5['pursant']+= $sabtnam->porsant;


                            if($itemadsl->nasbdarmahal == 1){
                                $nasb=TblAddedInformation::find()->where(['sabtnam'=>'MVNO'])->andWhere(['name'=>'نصب'])->one();
                                if(  $nasb!=null){
                                    $send5['nasb'] +=$nasb->pursant;
                                }
                            }


                        }


                    }

                }
                $sendOk['ngn']= $send4;
                $sendOk['mvno']= $send5;

            }
            else{
                $sendOk['ngn']= $send4;
                $sendOk['mvno']= $send5;
            }





         return $sendOk;



        }else{

            $sendOk['msg']='اطلاعات ارسالی ناقص می باشئ.';
            $sendOk['result']=0;
            return $sendOk;
        }
    }


    public function actionChangepassword(){

        if(isset($_POST['username']) && $_POST['username']!=null
        && isset($_POST['oldpass']) && $_POST['oldpass']!=null
        && isset($_POST['newpass']) && $_POST['newpass']!=null
        && isset($_POST['repeatpass']) && $_POST['repeatpass']!=null

    ){


            $modeluser = User::find()->where([
                'username'=>$_POST['username']
            ])->one();


            if($modeluser!=null){

                $password = $modeluser->password_hash;
                if(!Yii::$app->security->validatePassword($_POST['oldpass'], $password)) {
                    $send['result'] = 0;
                    $send['msg'] = 'رمز عبور قدیمی معتبر نیست';
                    return $send;
                }else{


                    if($_POST['newpass'] == $_POST['repeatpass'] ){


                        $modeluser->password_hash = Yii::$app->security->generatePasswordHash($_POST['newpass']);



                        if($modeluser->save())
                        {
                            $send['result']=1;
                            $send['msg']='تغییر رمز عبور باموفقیت انجام شد';
                            return $send;
                        }
                        else
                        {
                            $send['result']=0;
                            $send['msg']='تغییر رمز عبور باموفقیت انجام نشد';
                            return $send;
                        }

                    }else{

                        $send['result']=0;
                        $send['msg']='رمز جدید و تکرار آن باید یکسان باشد';
                        return $send;
                    }



                }




            }

            else{

                $send['result']=0;
                $send['msg']='نام کاربری وارد شده صحیح نمی باشد';
                return $send;
            }




        }else{

            $send['result']=0;
            $send['msg']='اطلاعات ارسالی ناقص می باشد';
            return $send;
        }
    }


    public function actionUploadtoserver(){
        $target_path = yii::getAlias('@upload')."/";
        $target_path = $target_path . basename($_FILES['uploaded_file']['name']);
        try {
            //throw exception if can't move the file
            if (!move_uploaded_file($_FILES['uploaded_file']['tmp_name'], $target_path)) {
                throw new Exception('Could not move file');
            }

            echo "The file " . basename($_FILES['uploaded_file']['name']) .
                " has been uploaded";
        } catch (Exception $e) {
            die('File did not upload: ' . $e->getMessage());
        }
    }


}
